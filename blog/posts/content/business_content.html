<div class="separator"><div class="separator" style="clear: both; text-align: center;">
   <img alt="" 
   border="0" 
   data-original-height="2191" 
   data-original-width="4000" 
   height="351" 
   src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhsI9-S-ycTpGcoYMJgV9tJXjUCZ1v4r0xbp3xGBRF88FOIznKlh0xYTooLvqJK2rg5fWPm4ybcUIpCMOaSZYa4kTwZ63yaoThazVcq78BVy4Bd6F2xXEmFoFtoGa0ZTa9aKdwYiCEItyN_2T9HCnIyJO44OikFi1fF3CduvasdMwv01HrBDwGFOvCvpGo/w640-h351/group-diverse-people-having-business-meeting.jpg" width="640"
   />
   
   <br /><div style="text-align: left;"><br /></div><h1 style="text-align: left;">Context</h1><div style="text-align: left;">As a statistician, my work has the double-edged sword of being highly<i> visible</i>. Whether I'm making the presentation myself or fulfilling a viz request for someone else's high-level meeting in 20 minutes, knowing what's going to be digestible and compelling for the intended audience is the one soft skill that I wouldn't want to be in this business without. It's also one that you never truly master, a lot like my experience in education. When I can say that I fully grasp the spectrum of human emotions and capabilities in every possible context, then I'll be able to say that I can fully communicate any technical topic to any audience. Until then, all I can do is practice, practice, practice and hopefully be granted the opportunities to experiment and innovate with all kinds of business requirements and data layouts. I recently was up against such a challenge at work, with a pretty tight deadline no less, and I'm sharing some of the key points (on simulated data) of that day's journey here.</div><h1 style="text-align: left;">The Request</h1><div>Excel pivot charts are an essential tool these days, and the skillset to develop them is pretty common even among non-technical personnel. They are extremely versatile and powerful, and would do the job for a lot of contexts on their own. Here's the kind of table that I received and was asked to make a quickly-digestible visual out of:</div><div><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjhe7RRu6OAzTgReWpEY5REjB5vv6-2CYSZ5tFM9bpzFVdzo6l-TetbU5-dxDimqj-jhK1LUQqL3KfavJZ3VJQsr_11zEpDskK36jkzg5FN9jMt_Ijr0j_MKZ8DAn4ivEHSB-lG-lyNBkvdARFMuHnqWC-GhlQgNi64d0knEwtNcy59ZLCBnrscc68__bs/s1269/Screenshot%202023-06-29%20152657.png" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="498" data-original-width="1269" height="253" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjhe7RRu6OAzTgReWpEY5REjB5vv6-2CYSZ5tFM9bpzFVdzo6l-TetbU5-dxDimqj-jhK1LUQqL3KfavJZ3VJQsr_11zEpDskK36jkzg5FN9jMt_Ijr0j_MKZ8DAn4ivEHSB-lG-lyNBkvdARFMuHnqWC-GhlQgNi64d0knEwtNcy59ZLCBnrscc68__bs/w642-h253/Screenshot%202023-06-29%20152657.png" width="642" /></a></div><br /><div><br /></div><div style="text-align: left;"><div class="separator" style="clear: both; text-align: center;"><div style="text-align: left;">Definitely not half bad, as far as pivot tables go. In case it isn't obvious, this business is tracking productivity by the number of documents created in a medical records system. For this report, they wanted the above named practitioners, submitting three particular document types, over the previous four months. The data is organized well, but this wouldn't play well as a PowerPoint slide. That's where we come in!</div><h1 style="text-align: left;">The Problem</h1><div style="text-align: left;">Since pivot tables make things look a lot tidier than raw data sources, it appears to the untrained eye that visualizing this in some standard format is a simple task with not much consideration required. A lot of times you'll be asked to 'just make a chart'. But there are two problems with the situation as it stands:</div><div style="text-align: left;"><br /></div><div style="text-align: left;">1) Looking closely, you'll see that there are no less than four dimensions that the stakeholders are interested in. You have provider names for rows, three types of documents being aggregated, four months over which they are aggregated, and the aggregated sums themselves. This isn't exactly the 2-D problem it appears to be, so representing everything we've been given is a creative process that the analyst is trusted to carry out.</div><div style="text-align: left;"><br /></div><div style="text-align: left;">2) Excel doesn't have the granular charting capabilities required to solve this problem, and the pivot table format isn't digestible by any statistical suites that I know of. Here's an example of what Excel could pull off quickly if you asked it to:</div><div style="text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiavxh1edy2PGoWviA506rr4-18WvqumOSldcNZhFzfz-YtlwZ1v11Ur0S9euGC8hBF2eHxWQBPCmpMQK-3RRXjjfIVceGZI0mHWENV-NJddnh69mUA9UwaXn0eEQvhBtUm4CNpFZbqT971i9MtVvtM7XudMDShf5_CCcleYNMgwPjGl7fdSzQTN3MId50/s701/Screenshot%202023-06-30%20142309.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="468" data-original-width="701" height="428" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiavxh1edy2PGoWviA506rr4-18WvqumOSldcNZhFzfz-YtlwZ1v11Ur0S9euGC8hBF2eHxWQBPCmpMQK-3RRXjjfIVceGZI0mHWENV-NJddnh69mUA9UwaXn0eEQvhBtUm4CNpFZbqT971i9MtVvtM7XudMDShf5_CCcleYNMgwPjGl7fdSzQTN3MId50/w640-h428/Screenshot%202023-06-30%20142309.png" width="640" /></a></div><div class="separator" style="clear: both; text-align: center;"><br /></div><div class="separator" style="clear: both; text-align: center;"><br /></div><div style="text-align: left;">I really don't <i>hate </i>this idea, but 3D plots like this are generally discouraged since you will always be obscuring data points behind others. Remember also that you and I will understand it much better than the user <i>because we developed it</i>. This is a lot to take in for the average report consumer, and that's why we are going to respectfully request the raw data from which the pivot table was made and start over in SAS making something much simpler. Here's what we are going to end up with, which I think does a better job of communicating everything that the pivot table does. It has the added benefit of maintaining a color scheme consistent with the company style guide:</div><div style="text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgMO-yDJZj2AFxStphxWJJrEfsVFekZry-DIRI3IolMMpuXkCD0_CuRTduClghXwNtRirDPBo-I-amveE0q8SwfaiwFJ_sNU2-XGrpgoGwlaUshNi5wgOIf8-0UAqFzSHeXxuRnguAnfS38YGRgjevY9P1XRY7kp8RrnTgm6hGaolUC06wHHFFZrl8Y64Y/s1191/Screenshot%202023-06-29%20160434.png" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="788" data-original-width="1191" height="424" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgMO-yDJZj2AFxStphxWJJrEfsVFekZry-DIRI3IolMMpuXkCD0_CuRTduClghXwNtRirDPBo-I-amveE0q8SwfaiwFJ_sNU2-XGrpgoGwlaUshNi5wgOIf8-0UAqFzSHeXxuRnguAnfS38YGRgjevY9P1XRY7kp8RrnTgm6hGaolUC06wHHFFZrl8Y64Y/w640-h424/Screenshot%202023-06-29%20160434.png" width="640" /></a></div><h1 style="text-align: left;">Data Processing</h1><div style="text-align: left;">Of course I'm starting with the data import of the raw file into SAS, and inspecting it to see what we're dealing with. We'll look at the first 15 rows:</div><div style="text-align: left;"><br /></div><div style="text-align: left;"><pre class="r" style="background-color: whitesmoke; border-radius: 4px; border: 1px solid rgb(204, 204, 204); box-sizing: border-box; line-height: 1.42857; margin-bottom: 10px; margin-top: 0px; overflow-wrap: break-word; overflow: auto; padding: 9.5px; word-break: break-all;">libname proclib 'SAS-Library';
FILENAME REFFILE FILESRVC FOLDERPATH='*/folder'  FILENAME='raw_file.csv';
PROC IMPORT DATAFILE=REFFILE
	DBMS=CSV
	OUT=prod;
	GETNAMES=YES;
RUN;</pre><pre class="r" style="background-color: whitesmoke; border-radius: 4px; border: 1px solid rgb(204, 204, 204); box-sizing: border-box; line-height: 1.42857; margin-bottom: 10px; margin-top: 0px; overflow-wrap: break-word; overflow: auto; padding: 9.5px; word-break: break-all;">options obs=10;
proc print data=prod;
run;</pre></div><div class="separator" style="clear: both; text-align: center;"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEi7IVZBOtPPcL8RBU9H6Zr9y41TF2Z_CMcRhZDnJiFJvRZIz59nmv2ntgT4AJE9IyCV_7ED8-qZyehXyZXcQuEFJu8s4-muhLevx-8ELi9-NHAfe7VS8p0jInzElzt53M0v3jbOXs-xAYy3bJn9awwmQmJboGs6Fhz6-bmV3aQUWsM8hzJSrhYLBoUXLXA/s476/Screenshot%202023-06-30%20093151.png" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="277" data-original-width="476" height="233" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEi7IVZBOtPPcL8RBU9H6Zr9y41TF2Z_CMcRhZDnJiFJvRZIz59nmv2ntgT4AJE9IyCV_7ED8-qZyehXyZXcQuEFJu8s4-muhLevx-8ELi9-NHAfe7VS8p0jInzElzt53M0v3jbOXs-xAYy3bJn9awwmQmJboGs6Fhz6-bmV3aQUWsM8hzJSrhYLBoUXLXA/w400-h233/Screenshot%202023-06-30%20093151.png" width="400" /></a></div><div class="separator" style="clear: both; text-align: center;"><br /></div><div class="separator" style="clear: both; text-align: left;">Ok, this activity log has recorded the number of actions of each type performed by each user on each day in the 4-month window. This, unlike the pivot table, is something statistical software can work with- but one thing that isn't done yet is the segmentation into months. For that, it will be necessary to create a column that extracts the month from the date data, which itself means we need to make sure that SAS understands the second column as a date.&nbsp;</div><div class="separator" style="clear: both; text-align: left;"><br /></div><div style="text-align: left;"><pre class="r" style="background-color: whitesmoke; border-radius: 4px; border: 1px solid rgb(204, 204, 204); box-sizing: border-box; line-height: 1.42857; margin-bottom: 10px; margin-top: 0px; overflow-wrap: break-word; overflow: auto; padding: 9.5px; word-break: break-all;">data prod;
  set prod;
  format Stamp date.;
  Month = Stamp;
  format Month monname.;
run;</pre></div></div></div><div class="separator" style="clear: both; text-align: center;"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgqFA3TLhuHY9oc1uVMQuGFcql7KCxKRxN4sawZX9_8B7_1I77UzeRXkvydzINiZS_CwafEaHvWn2gtJUEIQHR5uvgiFv23g3aikpS4a2IPV87jKmlMULvdtxcfDPZaMPj6GuwNobl_8SXdEdZ7dVvMlqnXyUNDx1Mu0J495h1OmtlnKypfhJHYpxSLZSo/s895/Screenshot%202023-06-30%20094024.png" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="350" data-original-width="895" height="250" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgqFA3TLhuHY9oc1uVMQuGFcql7KCxKRxN4sawZX9_8B7_1I77UzeRXkvydzINiZS_CwafEaHvWn2gtJUEIQHR5uvgiFv23g3aikpS4a2IPV87jKmlMULvdtxcfDPZaMPj6GuwNobl_8SXdEdZ7dVvMlqnXyUNDx1Mu0J495h1OmtlnKypfhJHYpxSLZSo/w640-h250/Screenshot%202023-06-30%20094024.png" width="640" /></a></div><div class="separator" style="margin-left: 1em; margin-right: 1em;"><br /></div><h1 style="text-align: left;">
   Visualization Conceptualization</h1>
<div class="separator" style="clear: both; text-align: left;">With all the information of the original pivot table now available in standard columnar format, in theory we can get to the charting. Remember we are working with for dimensions here: name, quantity, type, and month. There are a few things to consider when designing a visualization with data like this:</div><div><ul style="text-align: left;"><li>The performance of each provider relative to the others should be clearly communicated at a glance.</li><li>The <i>ranking </i>of providers should be apparent, so users can quickly tell who is the most and least productive.</li><li>The fact that there is a time element here (months) means that some level of chronological trend should be visible, if it exists.</li><li>The segmentation of productivity into document types should be available, since it was clearly important to the designer of the pivot table.&nbsp;</li></ul><div class="separator" style="clear: both; text-align: left;">Of course you've already seen the final product, so you know where I'm going with this. My chart is going to do the following to address each of the above points:</div></div><div><ul style="text-align: left;"><li>Bar chart facets, or panels, for each user</li><li>Facets ordered by the overall sum of documents created for each user</li><li>Chronological order of monthly productivity numbers for each user</li><li>Bar chart stacks colored by document type</li></ul><div class="separator" style="clear: both; text-align: left;">Now what happens when we take the data we have and stick it into <b>proc sgpanel</b>, the SAS method for faceted charts?</div></div><div><br /></div><div style="text-align: left;"><pre class="r" style="background-color: whitesmoke; border-radius: 4px; border: 1px solid rgb(204, 204, 204); box-sizing: border-box; line-height: 1.42857; margin-bottom: 10px; margin-top: 0px; overflow-wrap: break-word; overflow: auto; padding: 9.5px; word-break: break-all;">options obs=max;
proc sgpanel data=prod;
  ods graphics on / width=1200px height=800px;
  title '4-Month Provider Productivity';
  panelby Name / rows = 3 columns = 7 novarname;
  vbar Month / response=Quantity group=Type stat=sum;
  colaxis valueattrs=(size=7);
  rowaxis label='Productivity (as measured by document creation)';
  keylegend / position = top;
  styleattrs datacolors=(BIGB VLIGB GGR);
run;
</pre></div><div class="separator" style="clear: both; text-align: left;"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgXV4Kwc5gqq5QaXNN4p7xMcniVi5rv1wYyR0ZdKcJJp0VtzgM6QnLwW67z85o-E5Mh8zItwjyzmKxk4n7fscQr-c2e9sA4IKzMve6GoQux16IgK7Qol6ww44UJDlih1murfrHhVzfsDYjT7NKKuat5yD-dXz0zlv8Hb34yq6qkzG03K1dKz328IYVI-yg/s1189/Screenshot%202023-06-30%20095921.png" style="margin-left: 1em; margin-right: 1em;">
  <div style="text-align: center"><img border="0" data-original-height="791" data-original-width="1189" height="426" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgXV4Kwc5gqq5QaXNN4p7xMcniVi5rv1wYyR0ZdKcJJp0VtzgM6QnLwW67z85o-E5Mh8zItwjyzmKxk4n7fscQr-c2e9sA4IKzMve6GoQux16IgK7Qol6ww44UJDlih1murfrHhVzfsDYjT7NKKuat5yD-dXz0zlv8Hb34yq6qkzG03K1dKz328IYVI-yg/w640-h426/Screenshot%202023-06-30%20095921.png" width="640" /></a></div><br /><div style="text-align: left;">What an improvement! But we're not seeing the sorting yet, since by default SAS is going to plot the target panel variable in the most obvious order it can think of, which in this case is alphabetical. It's not like the users are ranked in the original data, so that's something we have to fix ourselves before plotting. This, as it happens, is the trickiest part.&nbsp;</div><h1 style="text-align: left;">Visualization Processing</h1><div><div style="text-align: left;">The first order of business is to create a ranking of each provider by the sum of their overall productivity. Here is where we get to take advantage of SAS's primary means of data processing being SQL within proc statements.</div><div><br /></div><div><pre class="r" style="background-color: whitesmoke; border-radius: 4px; border: 1px solid rgb(204, 204, 204); box-sizing: border-box; line-height: 1.42857; margin-bottom: 10px; margin-top: 0px; overflow-wrap: break-word; overflow: auto; padding: 9.5px; word-break: break-all;">proc sql;
  create table rank as
    select Name, SUM(Quantity) as Total
    from prod
    group by Name
    order by Total DESC;
  select * from rank;
quit;</pre></div></div><div style="text-align: left;"><div class="separator" style="clear: both; text-align: left;">To get around certain limitations of SAS-SQL, I'm going to create a second table which uses <b>monotonic()</b> to explicitly rank the users with an integer row number and no other columns.</div><div class="separator" style="clear: both; text-align: left;"><br /></div><div><pre class="r" style="background-color: whitesmoke; border-radius: 4px; border: 1px solid rgb(204, 204, 204); box-sizing: border-box; line-height: 1.42857; margin-bottom: 10px; margin-top: 0px; overflow-wrap: break-word; overflow: auto; padding: 9.5px; word-break: break-all;">proc sql;
	create table rank_names as
	select monotonic() as rank, Name
	from rank;
quit;</pre></div></div><div style="text-align: left;"><div>With all this in mind, I'm going to create a second version of the original 'prod' table called 'rank_prod' which includes a column with the ranking number of each user. This is so that we can use this as the <b>panelby</b>&nbsp;argument and have the panels sorted automatically in increasing order. This is easy enough using an inner join to the rank table we created.</div><div>&nbsp;</div><div><pre class="r" style="background-color: whitesmoke; border-radius: 4px; border: 1px solid rgb(204, 204, 204); box-sizing: border-box; line-height: 1.42857; margin-bottom: 10px; margin-top: 0px; overflow-wrap: break-word; overflow: auto; padding: 9.5px; word-break: break-all;">proc sql noprint;
	create table rank_prod as
	select a.Name, b.rank, a.Month, a.Type, a.Quantity
	from prod a
    inner join rank_names b on a.Name = b.Name
	order by rank asc;
run;</pre></div></div><div style="text-align: left;"><div>This creates one small issue, since by default the label for each panel will by be replaced by a rank number. This hardly communicates what we need, so we need a solution to format the panel labels by name instead. I must confess I didn't know how to do this without manually typing out the correspondence as seen in <a href="https://blogs.sas.com/content/graphicallyspeaking/2012/12/17/sorting-out-your-panelled-graphs-part-1/">this</a> article, and with 21 names I knew there had to be a better solution. This is what I came up with after a bit of research, to be passed to the <b>format </b>argument of sgplot. It uses the 'rank_names' table from earlier to map the numbers to names:</div><div><br /></div><div><pre class="r" style="background-color: whitesmoke; border-radius: 4px; border: 1px solid rgb(204, 204, 204); box-sizing: border-box; line-height: 1.42857; margin-bottom: 10px; margin-top: 0px; overflow-wrap: break-word; overflow: auto; padding: 9.5px; word-break: break-all;">data format_input;
  set rank_names;
  retain fmtname 'rank_fmt'; 
  start = rank;
  end = rank;
  label = Name; 
run;
proc format cntlin=format_input;
run;</pre></div></div><div style="text-align: left;">Now the <b>format </b>argument in <b>proc sgpanel </b>will use&nbsp;<b>rank_fmt </b>to&nbsp;label the panels instead of the default rank variable. Let's take one more look at the complete visualization:</div><div style="text-align: left;"><br /></div><div style="text-align: left;"><div><pre class="r" style="background-color: whitesmoke; border-radius: 4px; border: 1px solid rgb(204, 204, 204); box-sizing: border-box; line-height: 1.42857; margin-bottom: 10px; margin-top: 0px; overflow-wrap: break-word; overflow: auto; padding: 9.5px; word-break: break-all;">proc sgpanel data=rank_prod;
  ods graphics on / width=1200px height=800px;
  title '4-Month Provider Productivity';
  panelby rank / rows = 3 columns = 7 novarname;
  format rank rank_fmt.;
  vbar Month / response=Quantity group=Type stat=sum;
  colaxis valueattrs=(size=7);
  rowaxis label='Productivity (as measured by document creation)';
  keylegend / position = top;
  styleattrs datacolors=(BIGB VLIGB GGR);
run;</pre></div></div><div style="text-align: left;"><div class="separator" style="clear: both; text-align: center;"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjhi0yOOCV0T_CVc6h9FfqJ8yTKLkz3QXI2tPoaTdqiMa9zMjY00GC61MVA3jR-IuF8UVObnvOckFwHPfm3oMIo-TPMBkNZHWjolAf_7yql3quedmDZGa9ZYRm6gGIrKKdPfcFSF1a6YTJHXVIdHh_PrcJvlMrUeaMRLxKTtcqaaH0ZNddgM7IFQhzDKJQ/s1191/Screenshot%202023-06-29%20160434.png" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="788" data-original-width="1191" height="424" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjhi0yOOCV0T_CVc6h9FfqJ8yTKLkz3QXI2tPoaTdqiMa9zMjY00GC61MVA3jR-IuF8UVObnvOckFwHPfm3oMIo-TPMBkNZHWjolAf_7yql3quedmDZGa9ZYRm6gGIrKKdPfcFSF1a6YTJHXVIdHh_PrcJvlMrUeaMRLxKTtcqaaH0ZNddgM7IFQhzDKJQ/w640-h424/Screenshot%202023-06-29%20160434.png" width="640" /></a></div><div class="separator" style="clear: both; text-align: center;"><br /></div><div class="separator" style="clear: both; text-align: left;">Now that does the job. What do you think, would you have designed this differently? Would a 3D-approach with stacked bars and ordering do the job just as well, or worse?</div></div></div></div><br /><br />