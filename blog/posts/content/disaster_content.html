<div><span style="color: #444444; font-family: helvetica;"><span style="caret-color: rgb(68, 68, 68);"><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto;"><tbody><tr><td style="text-align: center;"><a href="https://blogger.googleusercontent.com/img/a/AVvXsEgDS7bDzx5nNlIj9f0xcGKtsiHchMf4RBLgBZnyw5MSED1uWEZ6UFJXrMubNvIcZPWFMUfasL7fEQ6OpaKGCURItg6UyCn2siTl-Sih7jd2hg5NTt8ZC1YzG9Y3Ig8_OPzP3JEKUJHw9uCqyYW6-JMWjXg8t9Uw7bW73vSG33YtGHpz9xIKNuqYEQLr" style="margin-left: auto; margin-right: auto;"><img data-original-height="4912" data-original-width="7360" height="428" src="https://blogger.googleusercontent.com/img/a/AVvXsEgDS7bDzx5nNlIj9f0xcGKtsiHchMf4RBLgBZnyw5MSED1uWEZ6UFJXrMubNvIcZPWFMUfasL7fEQ6OpaKGCURItg6UyCn2siTl-Sih7jd2hg5NTt8ZC1YzG9Y3Ig8_OPzP3JEKUJHw9uCqyYW6-JMWjXg8t9Uw7bW73vSG33YtGHpz9xIKNuqYEQLr=w640-h428" width="640" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;"><br /><i><span style="color: #999999;">Kathmandu, Nepal<span><!--more--></span></span></i></td></tr></tbody></table></span></span></div><div><span style="color: #444444; font-family: helvetica;"><span style="caret-color: rgb(68, 68, 68);"><br /></span></span></div><p style="box-sizing: border-box; margin: 0px 0px 10px; text-align: left;"><span style="color: #444444; font-family: helvetica;">In 2015, the city of Kathmandu in central Nepal was struck by a highly destructive, magnitude 7.8 earthquake which took the lives of approximately 9,000 people. Following the initial recovery efforts, the Nepalese government performed a door-to-door survey in 11 of the city districts with the aim of assessing eligibility for reconstruction assistance. This is the largest post-disaster structural data collection effort as of this writing. Kathmandu Living Labs updated the data in 2019 to further organize it and to reflect changes to the federal districting system, recognizing that the dataset on over 750,000 households would be of interest to anyone in the data science community with an interest in disaster recovery or socio-economic issues in developing countries<span class="math inline" style="box-sizing: border-box;"><span class="MathJax" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msup&gt;&lt;mi&gt;&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msup&gt;&lt;/math&gt;" id="MathJax-Element-1-Frame" role="presentation" style="border: 0px; box-sizing: border-box; direction: ltr; display: inline; float: none; font-size: 14px; line-height: normal; margin: 0px; max-height: none; max-width: none; min-height: 0px; min-width: 0px; overflow-wrap: normal; padding: 0px; position: relative; white-space: nowrap; word-spacing: normal;" tabindex="0"><nobr aria-hidden="true" style="border: 0px; box-sizing: border-box; line-height: normal; margin: 0px; max-height: 5000em; max-width: 5000em; min-height: 0px; min-width: 0px; padding: 0px; transition: none 0s ease 0s; vertical-align: 0px;"><span class="math" id="MathJax-Span-1" style="border: 0px; box-sizing: border-box; display: inline-block; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px; width: 0.598em;"><span style="border: 0px; box-sizing: border-box; display: inline-block; font-size: 16.799999px; height: 0px; line-height: normal; margin: 0px; padding: 0px; position: relative; transition: none 0s ease 0s; vertical-align: 0px; width: 0.479em;"><span style="border: 0px; box-sizing: border-box; clip: rect(1.193em, 1000.479em, 2.384em, -999.997em); left: 0em; line-height: normal; margin: 0px; padding: 0px; position: absolute; top: -2.199em; transition: none 0s ease 0s; vertical-align: 0px;"><span class="mrow" id="MathJax-Span-2" style="border: 0px; box-sizing: border-box; display: inline; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px;"><span class="msubsup" id="MathJax-Span-3" style="border: 0px; box-sizing: border-box; display: inline; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px;"><span style="border: 0px; box-sizing: border-box; display: inline-block; height: 0px; line-height: normal; margin: 0px; padding: 0px; position: relative; transition: none 0s ease 0s; vertical-align: 0px; width: 0.42em;"><span style="border: 0px; box-sizing: border-box; clip: rect(3.812em, 1000.003em, 4.17em, -999.997em); left: 0em; line-height: normal; margin: 0px; padding: 0px; position: absolute; top: -3.985em; transition: none 0s ease 0s; vertical-align: 0px;"><span class="mi" id="MathJax-Span-4" style="border: 0px; box-sizing: border-box; display: inline; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px;"></span><span style="border: 0px; box-sizing: border-box; display: inline-block; height: 3.991em; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px; width: 0px;"></span></span><span style="border: 0px; box-sizing: border-box; left: 0em; line-height: normal; margin: 0px; padding: 0px; position: absolute; top: -4.342em; transition: none 0s ease 0s; vertical-align: 0px;"><span class="mn" id="MathJax-Span-5" style="border: 0px; box-sizing: border-box; display: inline; font-family: STIXGeneral-Regular; font-size: 11.877599px; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px;">1</span><span style="border: 0px; box-sizing: border-box; display: inline-block; height: 3.991em; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px; width: 0px;"></span></span></span></span></span><span style="border: 0px; box-sizing: border-box; display: inline-block; height: 2.205em; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px; width: 0px;"></span></span></span><span style="border-left-style: solid; border-width: 0px; box-sizing: border-box; display: inline-block; height: 1.146em; line-height: normal; margin: 0px; overflow: hidden; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: -0.068em; width: 0px;"></span></span></nobr></span></span>. It is this data under consideration for the project, in which we develop exploratory visualizations on the extent of building damage. Additionaly, we use machine learning (specifically, the xgboost package) to investigate the significance of structural factors on building survivability.</span></p><h1 style="text-align: left;"><span style="font-family: helvetica;"><span style="color: #444444;">Acquisition and Nature of the Dataset</span></span></h1><div class="section level1" id="acquisition-and-nature-of-the-dataset" style="box-sizing: border-box;"><p style="box-sizing: border-box; margin: 0px 0px 10px; text-align: left;"><span style="color: #444444; font-family: helvetica;">The source of data for this project is the fantastic Open Data Portal made available for the 2015 Nepal Earthquake by the nonprofit Kathmandu Living Labs, with data initially collected by the Nepalese Government. It allows us to explore quite a few demographic features of 11 districts surrounding the city of Kathmandu. I am focusing on the ‘Structural Data’ set<span class="math inline" style="box-sizing: border-box;"><span class="MathJax" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msup&gt;&lt;mi&gt;&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;/math&gt;" id="MathJax-Element-2-Frame" role="presentation" style="border: 0px; box-sizing: border-box; direction: ltr; display: inline; float: none; font-size: 14px; line-height: normal; margin: 0px; max-height: none; max-width: none; min-height: 0px; min-width: 0px; overflow-wrap: normal; padding: 0px; position: relative; white-space: nowrap; word-spacing: normal;" tabindex="0"><nobr aria-hidden="true" style="border: 0px; box-sizing: border-box; line-height: normal; margin: 0px; max-height: 5000em; max-width: 5000em; min-height: 0px; min-width: 0px; padding: 0px; transition: none 0s ease 0s; vertical-align: 0px;"><span class="math" id="MathJax-Span-6" style="border: 0px; box-sizing: border-box; display: inline-block; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px; width: 0.598em;"><span style="border: 0px; box-sizing: border-box; display: inline-block; font-size: 16.799999px; height: 0px; line-height: normal; margin: 0px; padding: 0px; position: relative; transition: none 0s ease 0s; vertical-align: 0px; width: 0.479em;"><span style="border: 0px; box-sizing: border-box; clip: rect(1.193em, 1000.479em, 2.384em, -999.997em); left: 0em; line-height: normal; margin: 0px; padding: 0px; position: absolute; top: -2.199em; transition: none 0s ease 0s; vertical-align: 0px;"><span class="mrow" id="MathJax-Span-7" style="border: 0px; box-sizing: border-box; display: inline; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px;"><span class="msubsup" id="MathJax-Span-8" style="border: 0px; box-sizing: border-box; display: inline; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px;"><span style="border: 0px; box-sizing: border-box; display: inline-block; height: 0px; line-height: normal; margin: 0px; padding: 0px; position: relative; transition: none 0s ease 0s; vertical-align: 0px; width: 0.42em;"><span style="border: 0px; box-sizing: border-box; clip: rect(3.812em, 1000.003em, 4.17em, -999.997em); left: 0em; line-height: normal; margin: 0px; padding: 0px; position: absolute; top: -3.985em; transition: none 0s ease 0s; vertical-align: 0px;"><span class="mi" id="MathJax-Span-9" style="border: 0px; box-sizing: border-box; display: inline; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px;"></span><span style="border: 0px; box-sizing: border-box; display: inline-block; height: 3.991em; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px; width: 0px;"></span></span><span style="border: 0px; box-sizing: border-box; left: 0em; line-height: normal; margin: 0px; padding: 0px; position: absolute; top: -4.342em; transition: none 0s ease 0s; vertical-align: 0px;"><span class="mn" id="MathJax-Span-10" style="border: 0px; box-sizing: border-box; display: inline; font-family: STIXGeneral-Regular; font-size: 11.877599px; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px;">2</span><span style="border: 0px; box-sizing: border-box; display: inline-block; height: 3.991em; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px; width: 0px;"></span></span></span></span></span><span style="border: 0px; box-sizing: border-box; display: inline-block; height: 2.205em; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px; width: 0px;"></span></span></span><span style="border-left-style: solid; border-width: 0px; box-sizing: border-box; display: inline-block; height: 1.146em; line-height: normal; margin: 0px; overflow: hidden; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: -0.068em; width: 0px;"></span></span></nobr></span></span>&nbsp;on 760,000 buildings.</span></p><pre class="r" style="background-color: whitesmoke; border-radius: 4px; border: 1px solid rgb(204, 204, 204); box-sizing: border-box; caret-color: rgb(51, 51, 51); color: #333333; line-height: 1.428571; margin-bottom: 10px; margin-top: 0px; overflow-wrap: break-word; overflow: auto; padding: 9.5px; word-break: break-all;"><span style="font-size: x-small;"><code class="hljs" style="border-radius: 0px; box-sizing: border-box; padding: 0px; white-space: pre-wrap;"><span class="hljs-comment" style="box-sizing: border-box; color: #999988; font-style: italic;">#load locally stored dataframe</span>
df &lt;- read.csv(<span class="hljs-string" style="box-sizing: border-box; color: #dd1144;">"/Volumes/EXT128/Data Science Projects/building_structure/csv_building_structure.csv"</span>)
<span class="hljs-comment" style="box-sizing: border-box; color: #999988; font-style: italic;">#review structure of raw data</span>
str(df,vec.len=<span class="hljs-number" style="box-sizing: border-box; color: #009999;">1</span>)</code><span style="background-color: white; white-space: pre-wrap;">## 'data.frame':    762106 obs. of  31 variables:</span></span></pre><pre style="background-color: white; border-radius: 4px; border: 1px solid rgb(204, 204, 204); box-sizing: border-box; caret-color: rgb(51, 51, 51); color: #333333; line-height: 1.428571; margin-bottom: 10px; margin-top: 0px; overflow-wrap: break-word; overflow: auto; padding: 9.5px; word-break: break-all;"><code class="hljs" style="border-radius: 0px; box-sizing: border-box; padding: 0px; white-space: pre-wrap;"><span style="font-size: x-small;">##  $ building_id                           : num  1.2e+11 ...
##  $ district_id                           : int  12 12 ...
##  $ vdcmun_id                             : int  1207 1207 ...
##  $ ward_id                               : int  120703 120703 ...
##  $ count_floors_pre_eq                   : int  1 1 ...
##  $ count_floors_post_eq                  : int  1 1 ...
##  $ age_building                          : int  9 15 ...
##  $ plinth_area_sq_ft                     : int  288 364 ...
##  $ height_ft_pre_eq                      : int  9 9 ...
##  $ height_ft_post_eq                     : int  9 9 ...
##  $ land_surface_condition                : chr  "Flat" ...
##  $ foundation_type                       : chr  "Other" ...
##  $ roof_type                             : chr  "Bamboo/Timber-Light roof" ...
##  $ ground_floor_type                     : chr  "Mud" ...
##  $ other_floor_type                      : chr  "Not applicable" ...
##  $ position                              : chr  "Not attached" ...
##  $ plan_configuration                    : chr  "Rectangular" ...
##  $ has_superstructure_adobe_mud          : int  0 0 ...
##  $ has_superstructure_mud_mortar_stone   : int  1 1 ...
##  $ has_superstructure_stone_flag         : int  0 0 ...
##  $ has_superstructure_cement_mortar_stone: int  0 0 ...
##  $ has_superstructure_mud_mortar_brick   : int  0 0 ...
##  $ has_superstructure_cement_mortar_brick: int  0 0 ...
##  $ has_superstructure_timber             : int  0 0 ...
##  $ has_superstructure_bamboo             : int  1 1 ...
##  $ has_superstructure_rc_non_engineered  : int  0 0 ...
##  $ has_superstructure_rc_engineered      : int  0 0 ...
##  $ has_superstructure_other              : int  0 0 ...
##  $ condition_post_eq                     : chr  "Damaged-Used in risk" ...
##  $ damage_grade                          : chr  "Grade 3" ...
##  $ technical_solution_proposed           : chr  "Major repair" ...</span></code></pre><h1 style="box-sizing: border-box; font-size: 34px; line-height: 1.1; margin: 20px 0px 10px;"><span style="color: #444444; font-family: helvetica;">Data Cleaning</span></h1><p style="box-sizing: border-box; margin: 0px 0px 10px;"><span style="color: #444444; font-family: helvetica;">I’m studying the damage_grade column primarily, which is supposed to have five categories: Grade 1 is basically undamaged, and Grade 5 requires total demolition or reconstruction. More details on that scale can be found in the FAQ<span class="math inline" style="box-sizing: border-box;"><span class="MathJax" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msup&gt;&lt;mi&gt;&lt;/mi&gt;&lt;mn&gt;3&lt;/mn&gt;&lt;/msup&gt;&lt;/math&gt;" id="MathJax-Element-3-Frame" role="presentation" style="border: 0px; box-sizing: border-box; direction: ltr; display: inline; float: none; font-size: 14px; line-height: normal; margin: 0px; max-height: none; max-width: none; min-height: 0px; min-width: 0px; overflow-wrap: normal; padding: 0px; position: relative; white-space: nowrap; word-spacing: normal;" tabindex="0"><nobr aria-hidden="true" style="border: 0px; box-sizing: border-box; line-height: normal; margin: 0px; max-height: 5000em; max-width: 5000em; min-height: 0px; min-width: 0px; padding: 0px; transition: none 0s ease 0s; vertical-align: 0px;"><span class="math" id="MathJax-Span-11" style="border: 0px; box-sizing: border-box; display: inline-block; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px; width: 0.598em;"><span style="border: 0px; box-sizing: border-box; display: inline-block; font-size: 16.799999px; height: 0px; line-height: normal; margin: 0px; padding: 0px; position: relative; transition: none 0s ease 0s; vertical-align: 0px; width: 0.479em;"><span style="border: 0px; box-sizing: border-box; clip: rect(1.193em, 1000.479em, 2.384em, -999.997em); left: 0em; line-height: normal; margin: 0px; padding: 0px; position: absolute; top: -2.199em; transition: none 0s ease 0s; vertical-align: 0px;"><span class="mrow" id="MathJax-Span-12" style="border: 0px; box-sizing: border-box; display: inline; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px;"><span class="msubsup" id="MathJax-Span-13" style="border: 0px; box-sizing: border-box; display: inline; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px;"><span style="border: 0px; box-sizing: border-box; display: inline-block; height: 0px; line-height: normal; margin: 0px; padding: 0px; position: relative; transition: none 0s ease 0s; vertical-align: 0px; width: 0.42em;"><span style="border: 0px; box-sizing: border-box; clip: rect(3.812em, 1000.003em, 4.17em, -999.997em); left: 0em; line-height: normal; margin: 0px; padding: 0px; position: absolute; top: -3.985em; transition: none 0s ease 0s; vertical-align: 0px;"><span class="mi" id="MathJax-Span-14" style="border: 0px; box-sizing: border-box; display: inline; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px;"></span><span style="border: 0px; box-sizing: border-box; display: inline-block; height: 3.991em; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px; width: 0px;"></span></span><span style="border: 0px; box-sizing: border-box; left: 0em; line-height: normal; margin: 0px; padding: 0px; position: absolute; top: -4.342em; transition: none 0s ease 0s; vertical-align: 0px;"><span class="mn" id="MathJax-Span-15" style="border: 0px; box-sizing: border-box; display: inline; font-size: 11.877599px; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px;">3</span><span style="border: 0px; box-sizing: border-box; display: inline-block; height: 3.991em; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px; width: 0px;"></span></span></span></span></span><span style="border: 0px; box-sizing: border-box; display: inline-block; height: 2.205em; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px; width: 0px;"></span></span></span><span style="border-left-style: solid; border-width: 0px; box-sizing: border-box; display: inline-block; height: 1.146em; line-height: normal; margin: 0px; overflow: hidden; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: -0.068em; width: 0px;"></span></span></nobr></span></span>&nbsp;provided by KLL. With this priority and my intended mapping visualization in mind, I’m going to convert the this column to a numeric. I’m also going to add a damage description variable for a chart later on.</span></p><pre class="r" style="background-color: whitesmoke; border-radius: 4px; border: 1px solid rgb(204, 204, 204); box-sizing: border-box; caret-color: rgb(51, 51, 51); color: #333333; line-height: 1.428571; margin-bottom: 10px; margin-top: 0px; overflow-wrap: break-word; overflow: auto; padding: 9.5px; word-break: break-all;"><code class="hljs" style="border-radius: 0px; box-sizing: border-box; padding: 0px; white-space: pre-wrap;"><span style="font-size: x-small;"><span class="hljs-comment" style="box-sizing: border-box; color: #999988; font-style: italic;">#damage grade to integers</span>
df$damage_grade[df$damage_grade == <span class="hljs-string" style="box-sizing: border-box; color: #dd1144;">'Grade 5'</span>] &lt;- <span class="hljs-number" style="box-sizing: border-box; color: #009999;">5</span>
df$damage_grade[df$damage_grade == <span class="hljs-string" style="box-sizing: border-box; color: #dd1144;">'Grade 4'</span>] &lt;- <span class="hljs-number" style="box-sizing: border-box; color: #009999;">4</span>
df$damage_grade[df$damage_grade == <span class="hljs-string" style="box-sizing: border-box; color: #dd1144;">'Grade 3'</span>] &lt;- <span class="hljs-number" style="box-sizing: border-box; color: #009999;">3</span>
df$damage_grade[df$damage_grade == <span class="hljs-string" style="box-sizing: border-box; color: #dd1144;">'Grade 2'</span>] &lt;- <span class="hljs-number" style="box-sizing: border-box; color: #009999;">2</span>
df$damage_grade[df$damage_grade == <span class="hljs-string" style="box-sizing: border-box; color: #dd1144;">'Grade 1'</span>] &lt;- <span class="hljs-number" style="box-sizing: border-box; color: #009999;">1</span>
<span class="hljs-comment" style="box-sizing: border-box; color: #999988; font-style: italic;">#change data type</span>
df$damage_grade &lt;- as.integer(df$damage_grade)
<span class="hljs-comment" style="box-sizing: border-box; color: #999988; font-style: italic;">#add description column</span>
df$damage_desc &lt;- <span class="hljs-literal" style="box-sizing: border-box; color: #990073;">NA</span>
<span class="hljs-comment" style="box-sizing: border-box; color: #999988; font-style: italic;">#input appropriate damage grades</span>
df$damage_desc[df$damage_grade == <span class="hljs-number" style="box-sizing: border-box; color: #009999;">1</span>] &lt;- <span class="hljs-string" style="box-sizing: border-box; color: #dd1144;">'Cosmetic Repair'</span>
df$damage_desc[df$damage_grade == <span class="hljs-number" style="box-sizing: border-box; color: #009999;">2</span>] &lt;- <span class="hljs-string" style="box-sizing: border-box; color: #dd1144;">'Minor Structural Repair'</span>
df$damage_desc[df$damage_grade == <span class="hljs-number" style="box-sizing: border-box; color: #009999;">3</span>] &lt;- <span class="hljs-string" style="box-sizing: border-box; color: #dd1144;">'Major Structural Repair'</span>
df$damage_desc[df$damage_grade == <span class="hljs-number" style="box-sizing: border-box; color: #009999;">4</span>] &lt;- <span class="hljs-string" style="box-sizing: border-box; color: #dd1144;">'Unsafe / Structurally Unsound'</span>
df$damage_desc[df$damage_grade == <span class="hljs-number" style="box-sizing: border-box; color: #009999;">5</span>] &lt;- <span class="hljs-string" style="box-sizing: border-box; color: #dd1144;">'Total Collapse'</span></span></code></pre><p style="box-sizing: border-box; margin: 0px 0px 10px;"><span style="background-color: white; caret-color: rgb(51, 51, 51);"><span style="color: #444444; font-family: helvetica;">Another thing is that I’m interested in the district-level damage statistics. It will help to have the district names available to us, which I retrieved from the data dictionary to match up with the ID numbers. I’ll attach this information to the dataframe using an inner join.</span></span></p><pre class="r" style="background-color: whitesmoke; border-radius: 4px; border: 1px solid rgb(204, 204, 204); box-sizing: border-box; caret-color: rgb(51, 51, 51); color: #333333; line-height: 1.428571; margin-bottom: 10px; margin-top: 0px; overflow-wrap: break-word; overflow: auto; padding: 9.5px; word-break: break-all;"><code class="hljs" style="border-radius: 0px; box-sizing: border-box; padding: 0px; white-space: pre-wrap;"><span style="font-size: x-small;"><span class="hljs-comment" style="box-sizing: border-box; color: #999988; font-style: italic;">#get names</span>
dist_name &lt;- c(<span class="hljs-string" style="box-sizing: border-box; color: #dd1144;">'Okhaldhunga'</span>,<span class="hljs-string" style="box-sizing: border-box; color: #dd1144;">'Sindhuli'</span>,<span class="hljs-string" style="box-sizing: border-box; color: #dd1144;">'Ramechhap'</span>,<span class="hljs-string" style="box-sizing: border-box; color: #dd1144;">'Dolakha'</span>,<span class="hljs-string" style="box-sizing: border-box; color: #dd1144;">'Sindhupalchok'</span>,<span class="hljs-string" style="box-sizing: border-box; color: #dd1144;">'Kavrepalanchok'</span>,<span class="hljs-string" style="box-sizing: border-box; color: #dd1144;">'Nuwakot'</span>,<span class="hljs-string" style="box-sizing: border-box; color: #dd1144;">'Rasuwa'</span>,<span class="hljs-string" style="box-sizing: border-box; color: #dd1144;">'Dhading'</span>,<span class="hljs-string" style="box-sizing: border-box; color: #dd1144;">'Makwanpur'</span>,<span class="hljs-string" style="box-sizing: border-box; color: #dd1144;">'Gorkha'</span>)
<span class="hljs-comment" style="box-sizing: border-box; color: #999988; font-style: italic;">#get ids</span>
dist_id &lt;- c(<span class="hljs-number" style="box-sizing: border-box; color: #009999;">12</span>,<span class="hljs-number" style="box-sizing: border-box; color: #009999;">20</span>,<span class="hljs-number" style="box-sizing: border-box; color: #009999;">21</span>,<span class="hljs-number" style="box-sizing: border-box; color: #009999;">22</span>,<span class="hljs-number" style="box-sizing: border-box; color: #009999;">23</span>,<span class="hljs-number" style="box-sizing: border-box; color: #009999;">24</span>,<span class="hljs-number" style="box-sizing: border-box; color: #009999;">28</span>,<span class="hljs-number" style="box-sizing: border-box; color: #009999;">29</span>,<span class="hljs-number" style="box-sizing: border-box; color: #009999;">30</span>,<span class="hljs-number" style="box-sizing: border-box; color: #009999;">31</span>,<span class="hljs-number" style="box-sizing: border-box; color: #009999;">36</span>)
<span class="hljs-comment" style="box-sizing: border-box; color: #999988; font-style: italic;">#create district information dataframe</span>
districts &lt;- data.frame(district_id = dist_id, district_name = dist_name)
<span class="hljs-comment" style="box-sizing: border-box; color: #999988; font-style: italic;">#inner join in district_id using merge() </span>
df &lt;- merge(districts,df,by=<span class="hljs-string" style="box-sizing: border-box; color: #dd1144;">"district_id"</span>)</span></code></pre><p style="box-sizing: border-box; margin: 0px 0px 10px;"><span style="background-color: white; caret-color: rgb(51, 51, 51);"><span style="color: #444444; font-family: helvetica;">In the raw data there are 762,106 buildings observed with 31 variables recorded, and we need to check the quality of the data as far as errors and missing values go. We can check for NAs and numerical outliers in the traditional way, but one additional strategy we can employ is the detection of other kinds of errors using factors for the categorical variables. Factors will allow us to see if there are any anomalies in the number of levels. From the str() call earlier, we can see that the superstructure variable is one-hot encoded, which is great! But all of the other categorical fields are characters. I’m going to use the character datatype as a loop condition for transforming to factors, and then check the levels of each.</span></span></p><pre class="r" style="background-color: whitesmoke; border-radius: 4px; border: 1px solid rgb(204, 204, 204); box-sizing: border-box; caret-color: rgb(51, 51, 51); color: #333333; line-height: 1.428571; margin-bottom: 10px; margin-top: 0px; overflow-wrap: break-word; overflow: auto; padding: 9.5px; word-break: break-all;"><code class="hljs" style="border-radius: 0px; box-sizing: border-box; padding: 0px; white-space: pre-wrap;"><span style="font-size: x-small;"><span class="hljs-comment" style="box-sizing: border-box; color: #999988; font-style: italic;">#change any character variables to factors</span>
<span class="hljs-keyword" style="box-sizing: border-box; color: #990000; font-weight: bold;">for</span> (c <span class="hljs-keyword" style="box-sizing: border-box; color: #990000; font-weight: bold;">in</span> names(df)[sapply(df,is.character)])
  df[[c]] &lt;- as.factor(df[[c]])</span></code></pre><pre class="r" style="background-color: whitesmoke; border-radius: 4px; border: 1px solid rgb(204, 204, 204); box-sizing: border-box; caret-color: rgb(51, 51, 51); color: #333333; line-height: 1.428571; margin-bottom: 10px; margin-top: 0px; overflow-wrap: break-word; overflow: auto; padding: 9.5px; word-break: break-all;"><code class="hljs" style="border-radius: 0px; box-sizing: border-box; padding: 0px; white-space: pre-wrap;"><span style="font-size: x-small;"><span class="hljs-comment" style="box-sizing: border-box; color: #999988; font-style: italic;">#check factor levels for errors or missing information</span>
lapply(df[sapply(df, is.factor)], levels)</span></code></pre><pre style="background-color: white; border-radius: 4px; border: 1px solid rgb(204, 204, 204); box-sizing: border-box; caret-color: rgb(51, 51, 51); color: #333333; line-height: 1.428571; margin-bottom: 10px; margin-top: 0px; overflow-wrap: break-word; overflow: auto; padding: 9.5px; word-break: break-all;"><code class="hljs" style="border-radius: 0px; box-sizing: border-box; padding: 0px; white-space: pre-wrap;"><span style="font-size: x-small;">## $district_name
##  [1] "Dhading"        "Dolakha"        "Gorkha"         "Kavrepalanchok"
##  [5] "Makwanpur"      "Nuwakot"        "Okhaldhunga"    "Ramechhap"     
##  [9] "Rasuwa"         "Sindhuli"       "Sindhupalchok" 
## 
## $land_surface_condition
## [1] "Flat"           "Moderate slope" "Steep slope"   
## 
## $foundation_type
## [1] "Bamboo/Timber"          "Cement-Stone/Brick"     "Mud mortar-Stone/Brick"
## [4] "Other"                  "RC"                    
## 
## $roof_type
## [1] "Bamboo/Timber-Heavy roof" "Bamboo/Timber-Light roof"
## [3] "RCC/RB/RBC"              
## 
## $ground_floor_type
## [1] "Brick/Stone" "Mud"         "Other"       "RC"          "Timber"     
## 
## $other_floor_type
## [1] "Not applicable"    "RCC/RB/RBC"        "Timber-Planck"    
## [4] "TImber/Bamboo-Mud"
## 
## $position
## [1] ""                "Attached-1 side" "Attached-2 side" "Attached-3 side"
## [5] "Not attached"   
## 
## $plan_configuration
##  [1] ""                                "Building with Central Courtyard"
##  [3] "E-shape"                         "H-shape"                        
##  [5] "L-shape"                         "Multi-projected"                
##  [7] "Others"                          "Rectangular"                    
##  [9] "Square"                          "T-shape"                        
## [11] "U-shape"                        
## 
## $condition_post_eq
## [1] "Covered by landslide"                   
## [2] "Damaged-Not used"                       
## [3] "Damaged-Repaired and used"              
## [4] "Damaged-Rubble clear"                   
## [5] "Damaged-Rubble Clear-New building built"
## [6] "Damaged-Rubble unclear"                 
## [7] "Damaged-Used in risk"                   
## [8] "Not damaged"                            
## 
## $technical_solution_proposed
## [1] ""               "Major repair"   "Minor repair"   "No need"       
## [5] "Reconstruction"
## 
## $damage_desc
## [1] "Cosmetic Repair"               "Major Structural Repair"      
## [3] "Minor Structural Repair"       "Total Collapse"               
## [5] "Unsafe / Structurally Unsound"</span></code></pre><p style="box-sizing: border-box; margin: 0px 0px 10px;"><span style="background-color: white; caret-color: rgb(51, 51, 51);"><span style="color: #444444; font-family: helvetica;">This actually revealed something pretty important- a few of the categorical variables have “ ” levels which indicates that they would not have been detected by searching for NA values. I’m going to fix this issue by imputing NAs where the whitespace is so that missing information can be detected, and then check for the number of rows that are incomplete.</span></span></p><pre class="r" style="background-color: whitesmoke; border-radius: 4px; border: 1px solid rgb(204, 204, 204); box-sizing: border-box; caret-color: rgb(51, 51, 51); color: #333333; line-height: 1.428571; margin-bottom: 10px; margin-top: 0px; overflow-wrap: break-word; overflow: auto; padding: 9.5px; word-break: break-all;"><code class="hljs" style="border-radius: 0px; box-sizing: border-box; padding: 0px; white-space: pre-wrap;"><span style="font-size: x-small;"><span class="hljs-comment" style="box-sizing: border-box; color: #999988; font-style: italic;">#replace any whitespace with NA</span>
df[df == <span class="hljs-string" style="box-sizing: border-box; color: #dd1144;">""</span>] &lt;- <span class="hljs-literal" style="box-sizing: border-box; color: #990073;">NA</span>
<span class="hljs-comment" style="box-sizing: border-box; color: #999988; font-style: italic;">#complete cases check</span>
paste0(<span class="hljs-string" style="box-sizing: border-box; color: #dd1144;">'Number of rows with missing data: '</span>, sum(!complete.cases(df)))</span></code></pre><pre style="background-color: white; border-radius: 4px; border: 1px solid rgb(204, 204, 204); box-sizing: border-box; caret-color: rgb(51, 51, 51); color: #333333; line-height: 1.428571; margin-bottom: 10px; margin-top: 0px; overflow-wrap: break-word; overflow: auto; padding: 9.5px; word-break: break-all;"><code class="hljs" style="border-radius: 0px; box-sizing: border-box; padding: 0px; white-space: pre-wrap;"><span style="font-size: x-small;">## [1] "Number of rows with missing data: 12"</span></code></pre><p style="box-sizing: border-box; margin: 0px 0px 10px;"><span style="background-color: white; caret-color: rgb(51, 51, 51);"><span style="color: #444444; font-family: helvetica;">At least in the realm of blank spaces or NAs, this data seems to be pretty high quality. I don’t think that we will lose anything important if we were to remove these 12 observations since we have over 760,000.</span></span></p><pre class="r" style="background-color: whitesmoke; border-radius: 4px; border: 1px solid rgb(204, 204, 204); box-sizing: border-box; caret-color: rgb(51, 51, 51); color: #333333; line-height: 1.428571; margin-bottom: 10px; margin-top: 0px; overflow-wrap: break-word; overflow: auto; padding: 9.5px; word-break: break-all;"><code class="hljs" style="border-radius: 0px; box-sizing: border-box; padding: 0px; white-space: pre-wrap;"><span style="font-size: x-small;"><span class="hljs-comment" style="box-sizing: border-box; color: #999988; font-style: italic;">#remove the incomplete observations</span>
df &lt;- na.omit(df)
<span class="hljs-comment" style="box-sizing: border-box; color: #999988; font-style: italic;">#review dimensions of cleaned data</span>
paste0(<span class="hljs-string" style="box-sizing: border-box; color: #dd1144;">'Cleaned Data Dimension: '</span>, dim(df)[<span class="hljs-number" style="box-sizing: border-box; color: #009999;">1</span>],<span class="hljs-string" style="box-sizing: border-box; color: #dd1144;">' rows, '</span>,dim(df)[<span class="hljs-number" style="box-sizing: border-box; color: #009999;">2</span>],<span class="hljs-string" style="box-sizing: border-box; color: #dd1144;">' columns'</span>)</span></code></pre><pre style="background-color: white; border-radius: 4px; border: 1px solid rgb(204, 204, 204); box-sizing: border-box; caret-color: rgb(51, 51, 51); color: #333333; line-height: 1.428571; margin-bottom: 10px; margin-top: 0px; overflow-wrap: break-word; overflow: auto; padding: 9.5px; word-break: break-all;"><code class="hljs" style="border-radius: 0px; box-sizing: border-box; padding: 0px; white-space: pre-wrap;"><span style="font-size: x-small;">## [1] "Cleaned Data Dimension: 762094 rows, 33 columns"</span></code></pre><h1 style="box-sizing: border-box; caret-color: rgb(51, 51, 51); font-size: 34px; line-height: 1.1; margin: 20px 0px 10px;"><span style="color: #444444; font-family: helvetica;">Exploratory Visualizations</span></h1><p style="box-sizing: border-box; caret-color: rgb(51, 51, 51); margin: 0px 0px 10px;"><span style="color: #444444; font-family: helvetica;">We’ve done enough cleaning to begin visualizing the damage done by this quake. The first basic question is, how are the damage grades distributed? I’ll answer this with a bar chart which displays the damage levels, their definitions, and a color code established for the rest of the visualizations.</span></p><div class="separator" style="clear: both; text-align: center;"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiBqbEVtVO35uVU05exlVTVxREYh77_y9mSw9yqRT03fyvYSOls2eUupectNJJG2vjmymdjdISnliDOAnZO89ppJynf8EpKbc4XH0UAT-jmuKGYbLkRe284gIB0DhbLO7aEmOB9kMcmCKW-rh7xH_9gOwgfmtCfhVAqMf24097kFmI6CsaISBFK3Xb3/s720/unnamed-chunk-59-1.png" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="504" data-original-width="720" height="448" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiBqbEVtVO35uVU05exlVTVxREYh77_y9mSw9yqRT03fyvYSOls2eUupectNJJG2vjmymdjdISnliDOAnZO89ppJynf8EpKbc4XH0UAT-jmuKGYbLkRe284gIB0DhbLO7aEmOB9kMcmCKW-rh7xH_9gOwgfmtCfhVAqMf24097kFmI6CsaISBFK3Xb3/w640-h448/unnamed-chunk-59-1.png" width="640" /></a></div><br /><p style="box-sizing: border-box; caret-color: rgb(51, 51, 51); margin: 0px 0px 10px;"><span style="background-color: white;"><span style="color: #444444; font-family: helvetica;">Somewhat surprisingly, certainly tragically, the majority of buildings under study were flagged as irrepairably damaged or close to it! How does this break down by district?</span></span></p><pre class="r" style="background-color: whitesmoke; border-radius: 4px; border: 1px solid rgb(204, 204, 204); box-sizing: border-box; caret-color: rgb(51, 51, 51); color: #333333; line-height: 1.428571; margin-bottom: 10px; margin-top: 0px; overflow-wrap: break-word; overflow: auto; padding: 9.5px; word-break: break-all;"><code class="hljs" style="border-radius: 0px; box-sizing: border-box; padding: 0px; white-space: pre-wrap;"><span style="font-size: x-small;"><span class="hljs-comment" style="box-sizing: border-box; color: #999988; font-style: italic;">#forcats fct_infreq used in ggplot aes() for ordering the legend properly</span>
ggplot(data=df,aes(x=fct_rev(fct_infreq(district_name)),fill=factor(damage_grade)))+ 
  geom_bar(color = <span class="hljs-string" style="box-sizing: border-box; color: #dd1144;">"gray30"</span>,position = position_stack(reverse = <span class="hljs-literal" style="box-sizing: border-box; color: #990073;">TRUE</span>),stat = <span class="hljs-string" style="box-sizing: border-box; color: #dd1144;">"count"</span>)+
  labs(x=<span class="hljs-string" style="box-sizing: border-box; color: #dd1144;">'District'</span>,y=<span class="hljs-string" style="box-sizing: border-box; color: #dd1144;">'Building Assessments'</span>,title=<span class="hljs-string" style="box-sizing: border-box; color: #dd1144;">'Figure 2: Damaged Buildings by Grade Occurence and District'</span>,caption=<span class="hljs-string" style="box-sizing: border-box; color: #dd1144;">'Data: KLL'</span>)+
  scale_fill_viridis_d(option = <span class="hljs-string" style="box-sizing: border-box; color: #dd1144;">"viridis"</span>, name = <span class="hljs-string" style="box-sizing: border-box; color: #dd1144;">"Grade"</span>,direction=-<span class="hljs-number" style="box-sizing: border-box; color: #009999;">1</span>,guide=guide_legend(reverse=<span class="hljs-literal" style="box-sizing: border-box; color: #990073;">TRUE</span>))+
  theme(axis.text.x = element_text(angle = <span class="hljs-number" style="box-sizing: border-box; color: #009999;">45</span>, vjust = <span class="hljs-number" style="box-sizing: border-box; color: #009999;">1</span>, hjust=<span class="hljs-number" style="box-sizing: border-box; color: #009999;">1</span>))</span></code></pre><div class="separator" style="clear: both; text-align: center;"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEitaO-WXjGou63gvJTFwl_pWsKkrFZMGWopVxgfc0Io1vw3hO0yKgDtVKFvYjYw5ktNdt3YPMW5Sm5okQMfnSLlD5-xdn0cAnAFbB509CWUCZANLgBiIRbH7JxxfBBV_DILYI1GoZtn9cAygnLlU1wiVJ1EdZJT81k554VoXXPn5FvPmy3QzD1fxO35/s720/unnamed-chunk-60-1.png" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em; text-align: center;"><br /></a><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEitaO-WXjGou63gvJTFwl_pWsKkrFZMGWopVxgfc0Io1vw3hO0yKgDtVKFvYjYw5ktNdt3YPMW5Sm5okQMfnSLlD5-xdn0cAnAFbB509CWUCZANLgBiIRbH7JxxfBBV_DILYI1GoZtn9cAygnLlU1wiVJ1EdZJT81k554VoXXPn5FvPmy3QzD1fxO35/s720/unnamed-chunk-60-1.png" style="margin-left: 1em; margin-right: 1em; text-align: right;"><img border="0" data-original-height="504" data-original-width="720" height="450" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEitaO-WXjGou63gvJTFwl_pWsKkrFZMGWopVxgfc0Io1vw3hO0yKgDtVKFvYjYw5ktNdt3YPMW5Sm5okQMfnSLlD5-xdn0cAnAFbB509CWUCZANLgBiIRbH7JxxfBBV_DILYI1GoZtn9cAygnLlU1wiVJ1EdZJT81k554VoXXPn5FvPmy3QzD1fxO35/w640-h450/unnamed-chunk-60-1.png" width="640" /></a></div><div class="separator" style="clear: both; text-align: left;"><span style="caret-color: rgb(68, 68, 68); color: #444444; font-family: helvetica;">We can see that Sindhupalchok has a disproportionate amount of level 5 damage, but does not have the highest number of damaged buildings. Nearly every observed building in Rasuwa was totally destroyed, but it is a relatively small number of buildings. To get the whole picture, consider this chart in tandem with the next.</span></div><div class="section level1" id="mapping" style="box-sizing: border-box;"><h1 style="box-sizing: border-box; font-size: 34px; line-height: 1.1; margin: 20px 0px 10px;"><span style="color: #444444; font-family: helvetica;">Mapping</span></h1><p style="box-sizing: border-box; margin: 0px 0px 10px;"><span style="color: #444444; font-family: helvetica;">Next, I’m going to map out the average damage using ggplot’s geographic plotting so that anyone unfamiliar with the area surrounding Kathmandu can better understand the distribution. To do this we are going to need geographical data as well as some additional preprocessing. Database of Global Administrative Areas, or GADM, offers this kind of spatial data for most countries at various levels of granularity. I am retrieving their level 3 data<span class="math inline" style="box-sizing: border-box;"><span class="MathJax" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msup&gt;&lt;mi&gt;&lt;/mi&gt;&lt;mn&gt;4&lt;/mn&gt;&lt;/msup&gt;&lt;/math&gt;" id="MathJax-Element-4-Frame" role="presentation" style="border: 0px; box-sizing: border-box; direction: ltr; display: inline; float: none; font-size: 14px; line-height: normal; margin: 0px; max-height: none; max-width: none; min-height: 0px; min-width: 0px; overflow-wrap: normal; padding: 0px; position: relative; white-space: nowrap; word-spacing: normal;" tabindex="0"><nobr aria-hidden="true" style="border: 0px; box-sizing: border-box; line-height: normal; margin: 0px; max-height: 5000em; max-width: 5000em; min-height: 0px; min-width: 0px; padding: 0px; transition: none 0s ease 0s; vertical-align: 0px;"><span class="math" id="MathJax-Span-16" style="border: 0px; box-sizing: border-box; display: inline-block; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px; width: 0.598em;"><span style="border: 0px; box-sizing: border-box; display: inline-block; font-size: 16.799999px; height: 0px; line-height: normal; margin: 0px; padding: 0px; position: relative; transition: none 0s ease 0s; vertical-align: 0px; width: 0.479em;"><span style="border: 0px; box-sizing: border-box; clip: rect(1.193em, 1000.479em, 2.384em, -999.997em); left: 0em; line-height: normal; margin: 0px; padding: 0px; position: absolute; top: -2.199em; transition: none 0s ease 0s; vertical-align: 0px;"><span class="mrow" id="MathJax-Span-17" style="border: 0px; box-sizing: border-box; display: inline; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px;"><span class="msubsup" id="MathJax-Span-18" style="border: 0px; box-sizing: border-box; display: inline; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px;"><span style="border: 0px; box-sizing: border-box; display: inline-block; height: 0px; line-height: normal; margin: 0px; padding: 0px; position: relative; transition: none 0s ease 0s; vertical-align: 0px; width: 0.42em;"><span style="border: 0px; box-sizing: border-box; clip: rect(3.812em, 1000.003em, 4.17em, -999.997em); left: 0em; line-height: normal; margin: 0px; padding: 0px; position: absolute; top: -3.985em; transition: none 0s ease 0s; vertical-align: 0px;"><span class="mi" id="MathJax-Span-19" style="border: 0px; box-sizing: border-box; display: inline; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px;"></span><span style="border: 0px; box-sizing: border-box; display: inline-block; height: 3.991em; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px; width: 0px;"></span></span><span style="border: 0px; box-sizing: border-box; left: 0em; line-height: normal; margin: 0px; padding: 0px; position: absolute; top: -4.342em; transition: none 0s ease 0s; vertical-align: 0px;"><span class="mn" id="MathJax-Span-20" style="border: 0px; box-sizing: border-box; display: inline; font-size: 11.877599px; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px;">4</span><span style="border: 0px; box-sizing: border-box; display: inline-block; height: 3.991em; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px; width: 0px;"></span></span></span></span></span><span style="border: 0px; box-sizing: border-box; display: inline-block; height: 2.205em; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px; width: 0px;"></span></span></span><span style="border-left-style: solid; border-width: 0px; box-sizing: border-box; display: inline-block; height: 1.146em; line-height: normal; margin: 0px; overflow: hidden; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: -0.068em; width: 0px;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation" style="-webkit-user-select: none; border: 0px; box-sizing: border-box; clip: rect(1px, 1px, 1px, 1px); display: inline; height: 1px; left: 0px; line-height: normal; margin: 0px; overflow: hidden; padding: 0px; position: static; top: 0px; transition: none 0s ease 0s; vertical-align: 0px; width: 1px;"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi></mi><mn></mn></msup></math></span></span>&nbsp;for administrative districts of Nepal.</span></span></p><p style="box-sizing: border-box; margin: 0px 0px 10px;"><span class="math inline" style="box-sizing: border-box;"></span></p><pre class="r" style="background-color: whitesmoke; border-radius: 4px; border: 1px solid rgb(204, 204, 204); box-sizing: border-box; caret-color: rgb(51, 51, 51); color: #333333; line-height: 1.428571; margin-bottom: 10px; margin-top: 0px; overflow-wrap: break-word; overflow: auto; padding: 9.5px; word-break: break-all;"><code class="hljs" style="border-radius: 0px; box-sizing: border-box; padding: 0px; white-space: pre-wrap;"><span style="font-size: x-small;">nepal &lt;- st_read(<span class="hljs-string" style="box-sizing: border-box; color: #dd1144;">'/Volumes/EXT128/Data Science Projects/building_structure/building_structure/gadm41_NPL_shp/gadm41_NPL_3.shp'</span>)</span></code></pre></div><div class="separator" style="clear: both; text-align: left;"><span style="color: #444444; font-family: helvetica;">The earthquake data covers 11 districts surrounding the capital city of Kathmandu. As we will see, it does not cover Kathmandu itself nor the nearby central districts of Lalitpur and Bhaktapur. KLL outlines in its FAQ</span><span class="math inline" style="box-sizing: border-box;"><span style="color: #444444; font-family: helvetica;"><span class="MathJax" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msup&gt;&lt;mi&gt;&lt;/mi&gt;&lt;mn&gt;3&lt;/mn&gt;&lt;/msup&gt;&lt;/math&gt;" id="MathJax-Element-5-Frame" role="presentation" style="border: 0px; box-sizing: border-box; direction: ltr; display: inline; float: none; font-size: 14px; line-height: normal; margin: 0px; max-height: none; max-width: none; min-height: 0px; min-width: 0px; overflow-wrap: normal; padding: 0px; position: relative; white-space: nowrap; word-spacing: normal;" tabindex="0"><nobr aria-hidden="true" style="border: 0px; box-sizing: border-box; line-height: normal; margin: 0px; max-height: 5000em; max-width: 5000em; min-height: 0px; min-width: 0px; padding: 0px; transition: none 0s ease 0s; vertical-align: 0px;"><span class="math" id="MathJax-Span-21" style="border: 0px; box-sizing: border-box; display: inline-block; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px; width: 0.598em;"><span style="border: 0px; box-sizing: border-box; display: inline-block; font-size: 16.799999px; height: 0px; line-height: normal; margin: 0px; padding: 0px; position: relative; transition: none 0s ease 0s; vertical-align: 0px; width: 0.479em;"><span style="border: 0px; box-sizing: border-box; clip: rect(1.193em, 1000.479em, 2.384em, -999.997em); left: 0em; line-height: normal; margin: 0px; padding: 0px; position: absolute; top: -2.199em; transition: none 0s ease 0s; vertical-align: 0px;"><span class="mrow" id="MathJax-Span-22" style="border: 0px; box-sizing: border-box; display: inline; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px;"><span class="msubsup" id="MathJax-Span-23" style="border: 0px; box-sizing: border-box; display: inline; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px;"><span style="border: 0px; box-sizing: border-box; display: inline-block; height: 0px; line-height: normal; margin: 0px; padding: 0px; position: relative; transition: none 0s ease 0s; vertical-align: 0px; width: 0.42em;"><span style="border: 0px; box-sizing: border-box; clip: rect(3.812em, 1000.003em, 4.17em, -999.997em); left: 0em; line-height: normal; margin: 0px; padding: 0px; position: absolute; top: -3.985em; transition: none 0s ease 0s; vertical-align: 0px;"><span class="mi" id="MathJax-Span-24" style="border: 0px; box-sizing: border-box; display: inline; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px;"></span><span style="border: 0px; box-sizing: border-box; display: inline-block; height: 3.991em; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px; width: 0px;"></span></span><span style="border: 0px; box-sizing: border-box; left: 0em; line-height: normal; margin: 0px; padding: 0px; position: absolute; top: -4.342em; transition: none 0s ease 0s; vertical-align: 0px;"><span class="mn" id="MathJax-Span-25" style="border: 0px; box-sizing: border-box; display: inline; font-size: 11.877599px; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px;">3</span><span style="border: 0px; box-sizing: border-box; display: inline-block; height: 3.991em; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px; width: 0px;"></span></span></span></span></span><span style="border: 0px; box-sizing: border-box; display: inline-block; height: 2.205em; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px; width: 0px;"></span></span></span><span style="border-left-style: solid; border-width: 0px; box-sizing: border-box; display: inline-block; height: 1.146em; line-height: normal; margin: 0px; overflow: hidden; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: -0.068em; width: 0px;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation" style="-webkit-user-select: none; border: 0px; box-sizing: border-box; clip: rect(1px, 1px, 1px, 1px); display: inline; height: 1px; left: 0px; line-height: normal; margin: 0px; overflow: hidden; padding: 0px; position: static; top: 0px; transition: none 0s ease 0s; vertical-align: 0px; width: 1px;"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi></mi><mn></mn></msup></math></span></span>that this is because the project was made from Phase I government data collection- those three districts were surveyed in Phase II and the remaining districts of Nepal in Phase III. I’m going to isolate a map layer which shows those 11 districts and apply the necessary damage information to the resulting dataframe.</span><p></p><pre class="r" style="background-color: whitesmoke; border-radius: 4px; border: 1px solid rgb(204, 204, 204); box-sizing: border-box; caret-color: rgb(51, 51, 51); color: #333333; line-height: 1.428571; margin-bottom: 10px; margin-top: 0px; overflow-wrap: break-word; overflow: auto; padding: 9.5px; word-break: break-all;"><code class="hljs" style="border-radius: 0px; box-sizing: border-box; padding: 0px; white-space: pre-wrap;"><span style="font-size: x-small;"><span class="hljs-comment" style="box-sizing: border-box; color: #999988; font-style: italic;">#isolate earthquake-affected districts from map data</span>
nepal_eq &lt;- nepal[nepal$NAME_3 %<span class="hljs-keyword" style="box-sizing: border-box; color: #990000; font-weight: bold;">in</span>% dist_name,]
<span class="hljs-comment" style="box-sizing: border-box; color: #999988; font-style: italic;">#aggregation of districts by mean damage grade</span>
mean_dmg_dist &lt;- aggregate(df$damage_grade, list(df$district_name), FUN=mean)
<span class="hljs-comment" style="box-sizing: border-box; color: #999988; font-style: italic;">#assign column names for matching with geodata</span>
colnames(mean_dmg_dist) &lt;- c(<span class="hljs-string" style="box-sizing: border-box; color: #dd1144;">"NAME_3"</span>,<span class="hljs-string" style="box-sizing: border-box; color: #dd1144;">"DMG"</span>)
<span class="hljs-comment" style="box-sizing: border-box; color: #999988; font-style: italic;">#inner join damage and map</span>
nepal_eq &lt;- merge(nepal_eq,mean_dmg_dist,by=<span class="hljs-string" style="box-sizing: border-box; color: #dd1144;">"NAME_3"</span>)
<span class="hljs-comment" style="box-sizing: border-box; color: #999988; font-style: italic;">#mdg_order &lt;- mean_dmg_dist[order(mean_dmg_dist$DMG,decreasing = FALSE),]</span></span></code></pre><div style="text-align: left;"><span style="background-color: white;"><span style="color: #444444; font-family: helvetica;">Now the spatial data has the average damage grade attached for each district. One more thing is to prepare a layer for the central districts which do not have data, so at least we can have neutrally-colored representations for those instead of a hole in the center of the viz.</span></span></div><div style="text-align: left;"><span style="background-color: white;"><br /></span></div><pre class="r" style="background-color: whitesmoke; border-radius: 4px; border: 1px solid rgb(204, 204, 204); box-sizing: border-box; caret-color: rgb(51, 51, 51); color: #333333; line-height: 1.428571; margin-bottom: 10px; margin-top: 0px; overflow-wrap: break-word; overflow: auto; padding: 9.5px; word-break: break-all;"><code class="hljs" style="border-radius: 0px; box-sizing: border-box; padding: 0px; white-space: pre-wrap;"><span style="font-size: x-small;"><span class="hljs-comment" style="box-sizing: border-box; color: #999988; font-style: italic;">#vector of missing districts</span>
blank_name &lt;- c(<span class="hljs-string" style="box-sizing: border-box; color: #dd1144;">'Kathmandu'</span>,<span class="hljs-string" style="box-sizing: border-box; color: #dd1144;">'Lalitpur'</span>,<span class="hljs-string" style="box-sizing: border-box; color: #dd1144;">'Bhaktapur'</span>)
<span class="hljs-comment" style="box-sizing: border-box; color: #999988; font-style: italic;">#map subset of missing districts</span>
nepal_blank &lt;- nepal[nepal$NAME_3 %<span class="hljs-keyword" style="box-sizing: border-box; color: #990000; font-weight: bold;">in</span>% blank_name,]</span></code></pre><div style="text-align: left;"><span style="color: #444444; font-family: helvetica;">And finally for this map visualization we’ll make the lengthy call to ggplot:</span></div><div style="text-align: left;"><span style="font-family: helvetica;"><br /></span></div><pre class="r" style="background-color: whitesmoke; border-radius: 4px; border: 1px solid rgb(204, 204, 204); box-sizing: border-box; caret-color: rgb(51, 51, 51); color: #333333; line-height: 1.428571; margin-bottom: 10px; margin-top: 0px; overflow-wrap: break-word; overflow: auto; padding: 9.5px; word-break: break-all;"><code class="hljs" style="border-radius: 0px; box-sizing: border-box; padding: 0px; white-space: pre-wrap;"><span style="font-size: x-small;">ggplot() +
  <span class="hljs-comment" style="box-sizing: border-box; color: #999988; font-style: italic;">#unused districts layer</span>
  geom_sf(data=nepal_blank,fill=<span class="hljs-string" style="box-sizing: border-box; color: #dd1144;">'grey30'</span>)+ 
  geom_sf_text(data=nepal_blank,aes(label=NAME_3),size = <span class="hljs-number" style="box-sizing: border-box; color: #009999;">1.5</span>,fun.geometry = st_centroid,colour=<span class="hljs-string" style="box-sizing: border-box; color: #dd1144;">"white"</span>)+
  <span class="hljs-comment" style="box-sizing: border-box; color: #999988; font-style: italic;">#measured districts layer</span>
  geom_sf(data=nepal_eq,aes(fill=DMG))+
  geom_sf_text(data=nepal_eq,aes(label=NAME_3),size = <span class="hljs-number" style="box-sizing: border-box; color: #009999;">3</span>,fun.geometry=st_centroid,colour=<span class="hljs-string" style="box-sizing: border-box; color: #dd1144;">"white"</span>)+
  labs(x=<span class="hljs-literal" style="box-sizing: border-box; color: #990073;">NULL</span>,y=<span class="hljs-literal" style="box-sizing: border-box; color: #990073;">NULL</span>,title=<span class="hljs-string" style="box-sizing: border-box; color: #dd1144;">'Figure 3: 2015 "Ghorka" Earthquake, Average Structural Damage'</span>,subtitle=<span class="hljs-string" style="box-sizing: border-box; color: #dd1144;">'11 Survey Districts Surrounding Kathmandu, Nepal'</span>,caption=<span class="hljs-string" style="box-sizing: border-box; color: #dd1144;">'Data: KLL'</span>)+
  guides(colour = guide_colourbar(reverse = <span class="hljs-literal" style="box-sizing: border-box; color: #990073;">FALSE</span>))+
  scale_fill_viridis_c(option = <span class="hljs-string" style="box-sizing: border-box; color: #dd1144;">"viridis"</span>, name = <span class="hljs-string" style="box-sizing: border-box; color: #dd1144;">"Grade"</span>, limits=c(<span class="hljs-number" style="box-sizing: border-box; color: #009999;">0</span>,<span class="hljs-number" style="box-sizing: border-box; color: #009999;">5</span>),direction=-<span class="hljs-number" style="box-sizing: border-box; color: #009999;">1</span>)+
  theme(aspect.ratio=<span class="hljs-number" style="box-sizing: border-box; color: #009999;">5</span>/<span class="hljs-number" style="box-sizing: border-box; color: #009999;">8</span>)</span></code></pre></span><div class="separator" style="clear: both; text-align: center;"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgFsqxTDci4OuV61b4nz_JGIHpmfgHvBu6_sKj8czmbIrSA5emYIArdA-X7UrD0fUHg-XpX59UxMopyNL3x2vRIxv3rfSNQC_4NjPkMQnhwbGQqDOpRc0kDf8xb0WY0Vs6pWlEXPDew32iCLb_SE1IqHJPzsBY51G4ONsCKGmU9K6hlFa8IIdHPEXhI/s614/Screen%20Shot%202022-10-21%20at%2010.59.51%20PM.png" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="587" data-original-width="614" height="612" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgFsqxTDci4OuV61b4nz_JGIHpmfgHvBu6_sKj8czmbIrSA5emYIArdA-X7UrD0fUHg-XpX59UxMopyNL3x2vRIxv3rfSNQC_4NjPkMQnhwbGQqDOpRc0kDf8xb0WY0Vs6pWlEXPDew32iCLb_SE1IqHJPzsBY51G4ONsCKGmU9K6hlFa8IIdHPEXhI/w640-h612/Screen%20Shot%202022-10-21%20at%2010.59.51%20PM.png" width="640" /></a></div><br /><div class="separator" style="clear: both; text-align: left;"><div class="section level1" id="mapping" style="box-sizing: border-box;"><p style="box-sizing: border-box; margin: 0px 0px 10px;"><span style="color: #444444; font-family: helvetica;">Among the things that we can surmise from this visualization is that regions north of Kathmandu had the highest proportion of highly damaged buildings.</span></p></div><div class="section level1" id="machine-learning-with-structural-features" style="box-sizing: border-box;"><h1 style="box-sizing: border-box; font-size: 34px; line-height: 1.1; margin: 20px 0px 10px; text-align: left;"><span style="color: #444444; font-family: helvetica;">Machine Learning on Structural Features</span></h1><p style="box-sizing: border-box; margin: 0px 0px 10px;"><span style="color: #444444; font-family: helvetica;">Now, of course, earthquake results depend an awful lot on where you happen to be at the moment. But what about the structural information present in this data? Surely there’s something useful we can gain from it, so I’m going to try a machine learning algorithm to check the predictive ability of structural details on the outcome of damage grade. This is a supervised classification task, and the method I have chosen to use is XGBoost. This particular project isn’t really meant to be an in-depth look at machine learning algorithms, so for more information I recommend you check out the documentation<span class="math inline" style="box-sizing: border-box;"><span class="MathJax" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msup&gt;&lt;mi&gt;&lt;/mi&gt;&lt;mn&gt;5&lt;/mn&gt;&lt;/msup&gt;&lt;/math&gt;" id="MathJax-Element-6-Frame" role="presentation" style="border: 0px; box-sizing: border-box; direction: ltr; display: inline; float: none; font-size: 14px; line-height: normal; margin: 0px; max-height: none; max-width: none; min-height: 0px; min-width: 0px; overflow-wrap: normal; padding: 0px; position: relative; white-space: nowrap; word-spacing: normal;" tabindex="0"><nobr aria-hidden="true" style="border: 0px; box-sizing: border-box; line-height: normal; margin: 0px; max-height: 5000em; max-width: 5000em; min-height: 0px; min-width: 0px; padding: 0px; transition: none 0s ease 0s; vertical-align: 0px;"><span class="math" id="MathJax-Span-26" style="border: 0px; box-sizing: border-box; display: inline-block; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px; width: 0.598em;"><span style="border: 0px; box-sizing: border-box; display: inline-block; font-size: 16.799999px; height: 0px; line-height: normal; margin: 0px; padding: 0px; position: relative; transition: none 0s ease 0s; vertical-align: 0px; width: 0.479em;"><span style="border: 0px; box-sizing: border-box; clip: rect(1.193em, 1000.479em, 2.384em, -999.997em); left: 0em; line-height: normal; margin: 0px; padding: 0px; position: absolute; top: -2.199em; transition: none 0s ease 0s; vertical-align: 0px;"><span class="mrow" id="MathJax-Span-27" style="border: 0px; box-sizing: border-box; display: inline; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px;"><span class="msubsup" id="MathJax-Span-28" style="border: 0px; box-sizing: border-box; display: inline; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px;"><span style="border: 0px; box-sizing: border-box; display: inline-block; height: 0px; line-height: normal; margin: 0px; padding: 0px; position: relative; transition: none 0s ease 0s; vertical-align: 0px; width: 0.42em;"><span style="border: 0px; box-sizing: border-box; clip: rect(3.812em, 1000.003em, 4.17em, -999.997em); left: 0em; line-height: normal; margin: 0px; padding: 0px; position: absolute; top: -3.985em; transition: none 0s ease 0s; vertical-align: 0px;"><span class="mi" id="MathJax-Span-29" style="border: 0px; box-sizing: border-box; display: inline; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px;"></span><span style="border: 0px; box-sizing: border-box; display: inline-block; height: 3.991em; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px; width: 0px;"></span></span><span style="border: 0px; box-sizing: border-box; left: 0em; line-height: normal; margin: 0px; padding: 0px; position: absolute; top: -4.342em; transition: none 0s ease 0s; vertical-align: 0px;"><span class="mn" id="MathJax-Span-30" style="border: 0px; box-sizing: border-box; display: inline; font-size: 11.877599px; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px;">5</span><span style="border: 0px; box-sizing: border-box; display: inline-block; height: 3.991em; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px; width: 0px;"></span></span></span></span></span><span style="border: 0px; box-sizing: border-box; display: inline-block; height: 2.205em; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px; width: 0px;"></span></span></span><span style="border-left-style: solid; border-width: 0px; box-sizing: border-box; display: inline-block; height: 1.146em; line-height: normal; margin: 0px; overflow: hidden; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: -0.068em; width: 0px;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation" style="-webkit-user-select: none; border: 0px; box-sizing: border-box; clip: rect(1px, 1px, 1px, 1px); display: inline; height: 1px; left: 0px; line-height: normal; margin: 0px; overflow: hidden; padding: 0px; position: static; top: 0px; transition: none 0s ease 0s; vertical-align: 0px; width: 1px;"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi></mi><mn></mn></msup></math></span></span>&nbsp;on on the xgboost R package. Suffice to say, it’s is one of the most popular learning methods for classification tasks and is frequently utilized for award-winning projects.</span></span></p><div class="section level2" id="feature-selection" style="box-sizing: border-box;"><h2 style="text-align: left;"><span style="color: #444444; font-family: helvetica;">Feature Selection</span></h2><p style="box-sizing: border-box; margin: 0px 0px 10px;"><span style="color: #444444; font-family: helvetica;">The charts so far suggest that location is a very significant factor in building damage, so we are going to subset our data to remove the columns associated with location. Additionally, post-earthquake structural information (with the exception of the target variable, damage grade) is getting deleted since that is obviously correlated heavily with damage grade. It wouldn’t make sense to include them in a model for predicting post-disaster damage!</span></p></div></div></div><pre class="r" style="background-color: whitesmoke; border-radius: 4px; border: 1px solid rgb(204, 204, 204); box-sizing: border-box; caret-color: rgb(51, 51, 51); color: #333333; line-height: 1.428571; margin-bottom: 10px; margin-top: 0px; overflow-wrap: break-word; overflow: auto; padding: 9.5px; word-break: break-all;"><code class="hljs" style="border-radius: 0px; box-sizing: border-box; padding: 0px; white-space: pre-wrap;"><span style="font-size: x-small;"><span class="hljs-comment" style="box-sizing: border-box; color: #999988; font-style: italic;">#create dataframe for machine learning on structural details</span>
structure &lt;- df
<span class="hljs-comment" style="box-sizing: border-box; color: #999988; font-style: italic;">#remove some columns</span>
structure$district_id &lt;- <span class="hljs-literal" style="box-sizing: border-box; color: #990073;">NULL</span>
structure$district_name &lt;- <span class="hljs-literal" style="box-sizing: border-box; color: #990073;">NULL</span>
structure$building_id &lt;- <span class="hljs-literal" style="box-sizing: border-box; color: #990073;">NULL</span>
structure$vdcmun_id &lt;- <span class="hljs-literal" style="box-sizing: border-box; color: #990073;">NULL</span>
structure$ward_id &lt;- <span class="hljs-literal" style="box-sizing: border-box; color: #990073;">NULL</span>
structure$count_floors_post_eq &lt;- <span class="hljs-literal" style="box-sizing: border-box; color: #990073;">NULL</span>
structure$height_ft_post_eq &lt;- <span class="hljs-literal" style="box-sizing: border-box; color: #990073;">NULL</span>
structure$condition_post_eq &lt;- <span class="hljs-literal" style="box-sizing: border-box; color: #990073;">NULL</span>
structure$technical_solution_proposed &lt;- <span class="hljs-literal" style="box-sizing: border-box; color: #990073;">NULL</span>
structure$damage_desc &lt;- <span class="hljs-literal" style="box-sizing: border-box; color: #990073;">NULL</span>
structure$other_floor_type &lt;- <span class="hljs-literal" style="box-sizing: border-box; color: #990073;">NULL</span></span></code></pre></div><h2><span style="color: #444444; font-family: helvetica;">Data Preparation for XGBoost</span></h2><p style="box-sizing: border-box; caret-color: rgb(51, 51, 51); margin: 0px 0px 10px;"><span style="color: #444444; font-family: helvetica;">The next step is a subjective one. There are five damage grades, but we’re going to reduce that to two. Anything grade 3 or lower we will consider low damage, and anything higher than 3 will be the opposite. The descriptions in the raw data suggest there is a lot of overlap between assessments of grades 4 and 5. This is to say that the reduction of the problem into a binary classification is justifiable for the scope of this project<span style="font-size: 14px;">.</span></span></p><pre class="r" style="background-color: whitesmoke; border-radius: 4px; border: 1px solid rgb(204, 204, 204); box-sizing: border-box; caret-color: rgb(51, 51, 51); color: #333333; line-height: 1.428571; margin-bottom: 10px; margin-top: 0px; overflow-wrap: break-word; overflow: auto; padding: 9.5px; word-break: break-all;"><code class="hljs" style="border-radius: 0px; box-sizing: border-box; padding: 0px; white-space: pre-wrap;"><span style="font-size: x-small;"><span class="hljs-comment" style="box-sizing: border-box; color: #999988; font-style: italic;">#create binary target variable</span>
structure$damage_grade &lt;- ifelse(structure$damage_grade %<span class="hljs-keyword" style="box-sizing: border-box; color: #990000; font-weight: bold;">in</span>% c(<span class="hljs-number" style="box-sizing: border-box; color: #009999;">1</span>,<span class="hljs-number" style="box-sizing: border-box; color: #009999;">2</span>,<span class="hljs-number" style="box-sizing: border-box; color: #009999;">3</span>), <span class="hljs-number" style="box-sizing: border-box; color: #009999;">0</span>, <span class="hljs-number" style="box-sizing: border-box; color: #009999;">1</span>)</span></code></pre><p style="box-sizing: border-box; margin: 0px 0px 10px;"></p><div class="separator" style="clear: both; text-align: left;"><span style="background-color: white; caret-color: rgb(51, 51, 51);"><span style="color: #444444; font-family: arial;">One thing that’s interesting about this data is that Nepal is a very ancient place. We’d expect the age of a building to have something to do with its structural integrity, right? My question is, to what degree should we apply this study to ancient buildings? Their structural features wouldn’t fit well with the buildings in typical use, so I consider the 1000+ year old buildings I noticed in the data to be outliers.</span></span></div><div class="separator" style="clear: both; text-align: left;"><span face="&quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif" style="background-color: white; caret-color: rgb(51, 51, 51); color: #333333; font-size: 14px;"><br /></span></div><div class="separator" style="clear: both; text-align: left;"><pre class="r" style="background-color: whitesmoke; border-radius: 4px; border: 1px solid rgb(204, 204, 204); box-sizing: border-box; caret-color: rgb(51, 51, 51); color: #333333; line-height: 1.428571; margin-bottom: 10px; margin-top: 0px; overflow-wrap: break-word; overflow: auto; padding: 9.5px; word-break: break-all;"><code class="hljs" style="border-radius: 0px; box-sizing: border-box; padding: 0px; white-space: pre-wrap;"><span style="font-size: x-small;"><span class="hljs-comment" style="box-sizing: border-box; color: #999988; font-style: italic;">#eliminate ancient buildings</span>
structure &lt;- structure[structure$age_building &lt; <span class="hljs-number" style="box-sizing: border-box; color: #009999;">1000</span>,]</span></code></pre></div><span style="background-color: white; caret-color: rgb(51, 51, 51);"><span style="color: #444444; font-family: arial;">The next step is critical. Since computers can only really work with numbers, we need to get around the fact that much of the data we have access to here is categorical. Somewhat unique among datasets like this however is that the problem is partially fixed out of the box (Kathmandu Living Labs did a great job here, what can I say): the superstructure variable has in fact been one-hot encoded. This means that instead of a single column with a handful of possible inputs for each type of superstructure, we have 12 columns with names like has_superstructure_adobe_mud with possible values of 0 and 1 to indicate the state of a building’s superstructure. This is perfect as is and can be understood by ML packages, so we’re going to copy that pattern by one-hot encoding the other categorical variables. This time I’ll use a package, fastDummies, which carries out the process brilliantly. I just have to pass it the column names which need to be expanded, and be sure to pass it an argument that deletes the originals.</span></span><br /><div class="separator" style="clear: both; text-align: center;"><br /></div><pre class="r" style="background-color: whitesmoke; border-radius: 4px; border: 1px solid rgb(204, 204, 204); box-sizing: border-box; caret-color: rgb(51, 51, 51); color: #333333; line-height: 1.428571; margin-bottom: 10px; margin-top: 0px; overflow-wrap: break-word; overflow: auto; padding: 9.5px; word-break: break-all;"><code class="hljs" style="border-radius: 0px; box-sizing: border-box; padding: 0px; white-space: pre-wrap;"><span style="font-size: x-small;"><span class="hljs-comment" style="box-sizing: border-box; color: #999988; font-style: italic;">#one-hot encoding via fastDummies package</span>
onehot &lt;- dummy_cols(structure,select_columns=c(<span class="hljs-string" style="box-sizing: border-box; color: #dd1144;">'land_surface_condition'</span>,<span class="hljs-string" style="box-sizing: border-box; color: #dd1144;">'foundation_type'</span>,<span class="hljs-string" style="box-sizing: border-box; color: #dd1144;">'roof_type'</span>,<span class="hljs-string" style="box-sizing: border-box; color: #dd1144;">'ground_floor_type'</span>,<span class="hljs-string" style="box-sizing: border-box; color: #dd1144;">'position'</span>,<span class="hljs-string" style="box-sizing: border-box; color: #dd1144;">'plan_configuration'</span>),remove_first_dummy = <span class="hljs-literal" style="box-sizing: border-box; color: #990073;">FALSE</span>, remove_selected_columns = <span class="hljs-literal" style="box-sizing: border-box; color: #990073;">TRUE</span>)</span></code></pre><div class="separator" style="clear: both; text-align: left;"><span style="background-color: white; caret-color: rgb(51, 51, 51);"><span style="color: #444444; font-family: arial;">In the next step we’re going to split the data for testing and training. We’re holding out 15% of the set to test the model on.</span></span></div><div class="separator" style="clear: both; text-align: left;"><span face="&quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif" style="background-color: white; caret-color: rgb(51, 51, 51); color: #333333; font-size: 14px;"><br /></span></div><div class="separator" style="clear: both; text-align: left;"><pre class="r" style="background-color: whitesmoke; border-radius: 4px; border: 1px solid rgb(204, 204, 204); box-sizing: border-box; caret-color: rgb(51, 51, 51); color: #333333; line-height: 1.428571; margin-bottom: 10px; margin-top: 0px; overflow-wrap: break-word; overflow: auto; padding: 9.5px; word-break: break-all;"><code class="hljs" style="border-radius: 0px; box-sizing: border-box; padding: 0px; white-space: pre-wrap;"><span style="font-size: x-small;"><span class="hljs-comment" style="box-sizing: border-box; color: #999988; font-style: italic;">#train/test split at 85%</span>
set.seed(<span class="hljs-number" style="box-sizing: border-box; color: #009999;">43022</span>)
train_size &lt;- floor(<span class="hljs-number" style="box-sizing: border-box; color: #009999;">0.85</span> * nrow(onehot))
train_ind &lt;- sample(seq_len(nrow(onehot)), size = train_size)
train &lt;- onehot[train_ind, ]
test &lt;- onehot[-train_ind, ]</span></code></pre></div><span style="background-color: white; caret-color: rgb(51, 51, 51);"><span style="color: #444444; font-family: arial;">The next part is particular to the xgboost package. In order to train and test a model, it wants the matrix format specifically whereas currently we have a dataframe. Matrices can be though of as dataframes with additional optimization for strictly numeric cells, which we have thanks to the one-hot encoding from earlier. Also in this step, I am separating the target low/high damage prediction labels (coded as 0 and 1) from the prediction variables.</span></span></div><div class="section level1" id="acquisition-and-nature-of-the-dataset" style="box-sizing: border-box;"><span face="Helvetica Neue, Helvetica, Arial, sans-serif" style="color: #333333;"><span style="background-color: white; caret-color: rgb(51, 51, 51); font-size: 14px;"><br /></span></span></div><div class="section level1" id="acquisition-and-nature-of-the-dataset" style="box-sizing: border-box;"><pre class="r" style="background-color: whitesmoke; border-radius: 4px; border: 1px solid rgb(204, 204, 204); box-sizing: border-box; caret-color: rgb(51, 51, 51); color: #333333; line-height: 1.428571; margin-bottom: 10px; margin-top: 0px; overflow-wrap: break-word; overflow: auto; padding: 9.5px; word-break: break-all;"><code class="hljs" style="border-radius: 0px; box-sizing: border-box; padding: 0px; white-space: pre-wrap;"><span style="font-size: x-small;"><span class="hljs-comment" style="box-sizing: border-box; color: #999988; font-style: italic;">#separation of labels and predictors</span>
train_features &lt;- as.matrix(train[,-<span class="hljs-number" style="box-sizing: border-box; color: #009999;">16</span>])
train_labels &lt;- as.matrix(train[,<span class="hljs-number" style="box-sizing: border-box; color: #009999;">16</span>])
test_features &lt;- as.matrix(test[,-<span class="hljs-number" style="box-sizing: border-box; color: #009999;">16</span>])
test_labels &lt;- as.matrix(test[,<span class="hljs-number" style="box-sizing: border-box; color: #009999;">16</span>])</span></code></pre><span style="background-color: white; caret-color: rgb(51, 51, 51);"><span style="color: #444444; font-family: arial;"><h2 style="text-align: left;"><span style="background-color: white; caret-color: rgb(51, 51, 51);"><span style="font-family: arial;">Modeling with XGBoost</span></span></h2>Now we’re ready for the modeling. I’m utilizing the unique xgb.DMatrix object type, which is easy to convert from the standard R matrix. For purposes of this exploration, I’m going to use the default tuning parameters for xgboost though these are surely something I will be exploring in another article.</span></span><span face="&quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif" style="background-color: white; caret-color: rgb(51, 51, 51); color: #333333; font-size: 14px;"><br /></span><p></p><pre class="r" style="background-color: whitesmoke; border-radius: 4px; border: 1px solid rgb(204, 204, 204); box-sizing: border-box; caret-color: rgb(51, 51, 51); color: #333333; line-height: 1.428571; margin-bottom: 10px; margin-top: 0px; overflow-wrap: break-word; overflow: auto; padding: 9.5px; word-break: break-all;"><code class="hljs" style="border-radius: 0px; box-sizing: border-box; padding: 0px; white-space: pre-wrap;"><span style="font-size: x-small;"><span class="hljs-comment" style="box-sizing: border-box; color: #999988; font-style: italic;">#xgboost objects</span>
sindhuli_xgb_train &lt;- xgb.DMatrix(data = train_features, label= train_labels)
sindhuli_xgb_test &lt;- xgb.DMatrix(data = test_features, label= test_labels)
<span class="hljs-comment" style="box-sizing: border-box; color: #999988; font-style: italic;">#xgboost model with 25 runs, binary prediction objective</span>
model &lt;- xgboost(data = sindhuli_xgb_train,
                 nrounds = <span class="hljs-number" style="box-sizing: border-box; color: #009999;">25</span>,
                 verbose = <span class="hljs-number" style="box-sizing: border-box; color: #009999;">0</span>,
                 objective = <span class="hljs-string" style="box-sizing: border-box; color: #dd1144;">"binary:logistic"</span>) 
<span class="hljs-comment" style="box-sizing: border-box; color: #999988; font-style: italic;">#test set predictions, rounded since they are probabilities between 0 and 1 by default</span>
pred &lt;- round(predict(model, sindhuli_xgb_test))
<span class="hljs-comment" style="box-sizing: border-box; color: #999988; font-style: italic;">#test metrics from caret</span>
test_matrix &lt;- confusionMatrix(as.factor(pred), as.factor(test_labels))
test_matrix$table</span></code></pre><h2 style="text-align: left;"><span style="background-color: white;"><span style="color: #444444; font-family: arial;">Model Evaluation</span></span></h2><pre style="background-color: white; border-radius: 4px; border: 1px solid rgb(204, 204, 204); box-sizing: border-box; caret-color: rgb(51, 51, 51); color: #333333; line-height: 1.428571; margin-bottom: 10px; margin-top: 0px; overflow-wrap: break-word; overflow: auto; padding: 9.5px; word-break: break-all;"><code class="hljs" style="border-radius: 0px; box-sizing: border-box; padding: 0px; white-space: pre-wrap;"><span style="font-size: x-small;">##           Reference
## Prediction     0     1
##          0 20328  4689
##          1 25250 64048</span></code></pre><pre class="r" style="background-color: whitesmoke; border-radius: 4px; border: 1px solid rgb(204, 204, 204); box-sizing: border-box; caret-color: rgb(51, 51, 51); color: #333333; line-height: 1.428571; margin-bottom: 10px; margin-top: 0px; overflow-wrap: break-word; overflow: auto; padding: 9.5px; word-break: break-all;"><code class="hljs" style="border-radius: 0px; box-sizing: border-box; padding: 0px; white-space: pre-wrap;"><span style="font-size: x-small;">paste0(<span class="hljs-string" style="box-sizing: border-box; color: #dd1144;">'Accuracy: '</span>,round(test_matrix$overall[<span class="hljs-number" style="box-sizing: border-box; color: #009999;">1</span>],<span class="hljs-number" style="box-sizing: border-box; color: #009999;">2</span>),<span class="hljs-string" style="box-sizing: border-box; color: #dd1144;">' / P-Value: '</span>,test_matrix$overall[<span class="hljs-number" style="box-sizing: border-box; color: #009999;">6</span>])</span></code></pre><pre style="background-color: white; border-radius: 4px; border: 1px solid rgb(204, 204, 204); box-sizing: border-box; caret-color: rgb(51, 51, 51); color: #333333; line-height: 1.428571; margin-bottom: 10px; margin-top: 0px; overflow-wrap: break-word; overflow: auto; padding: 9.5px; word-break: break-all;"><code class="hljs" style="border-radius: 0px; box-sizing: border-box; padding: 0px; white-space: pre-wrap;"><span style="font-size: x-small;">## [1] "Accuracy: 0.74 / P-Value: 0"</span></code></pre><p style="box-sizing: border-box; caret-color: rgb(51, 51, 51); margin: 0px 0px 10px;"><span style="color: #444444; font-family: helvetica;">We obtained an accuracy of 74% with default xgboost parameters. There were a lot of misclassifications, particularly of the high damage class where the true outcome was low damage. But there is definitely something here, since the p-value indicates a statistically significant difference between our model vs.&nbsp;simply predicting the most common class. I should note that if you include the location information, the metrics turn out way better; I even did that with all five classes and still got significant results. However, as I discussed earlier that would not tell us much more than figures 2 and 3 do.</span></p><h2 style="text-align: left;"><span style="background-color: white;"><span style="color: #444444; font-family: helvetica;">Variable Importance</span></span></h2><p style="box-sizing: border-box; caret-color: rgb(51, 51, 51); margin: 0px 0px 10px;"><span style="color: #444444; font-family: helvetica;">So what of the structural details? In conclusion I’m going to investigate the variable importance as determined by the xgboost model.</span></p><pre class="r" style="background-color: whitesmoke; border-radius: 4px; border: 1px solid rgb(204, 204, 204); box-sizing: border-box; caret-color: rgb(51, 51, 51); color: #333333; line-height: 1.428571; margin-bottom: 10px; margin-top: 0px; overflow-wrap: break-word; overflow: auto; padding: 9.5px; word-break: break-all;"><code class="hljs" style="border-radius: 0px; box-sizing: border-box; padding: 0px; white-space: pre-wrap;"><span style="font-size: x-small;"><span class="hljs-comment" style="box-sizing: border-box; color: #999988; font-style: italic;">#extract variable importance matrix, top 10</span>
xgb_imp &lt;- xgb.importance (feature_names = colnames(train_features),model = model)[<span class="hljs-number" style="box-sizing: border-box; color: #009999;">1</span>:<span class="hljs-number" style="box-sizing: border-box; color: #009999;">10</span>]
<span class="hljs-comment" style="box-sizing: border-box; color: #999988; font-style: italic;">#plot feature vs. gain</span>
ggplot(data=xgb_imp)+
  geom_bar(aes(x=reorder(Feature,Gain),y=Gain,color=Gain),stat=<span class="hljs-string" style="box-sizing: border-box; color: #dd1144;">'identity'</span>,size=<span class="hljs-number" style="box-sizing: border-box; color: #009999;">1</span>)+
  theme(axis.text.y = element_text(angle = <span class="hljs-number" style="box-sizing: border-box; color: #009999;">45</span>, vjust = -<span class="hljs-number" style="box-sizing: border-box; color: #009999;">2</span>, hjust=<span class="hljs-number" style="box-sizing: border-box; color: #009999;">1</span>, size = <span class="hljs-number" style="box-sizing: border-box; color: #009999;">6</span>),legend.position=<span class="hljs-string" style="box-sizing: border-box; color: #dd1144;">'none'</span>)+
  labs(x= <span class="hljs-string" style="box-sizing: border-box; color: #dd1144;">'Feature'</span>, y = <span class="hljs-string" style="box-sizing: border-box; color: #dd1144;">'Gain'</span>, title=<span class="hljs-string" style="box-sizing: border-box; color: #dd1144;">'Figure 4: Variable Importance'</span>,subtitle=<span class="hljs-string" style="box-sizing: border-box; color: #dd1144;">'Structural features predicting earthquake damage during the 2015 Nepal Quake'</span>,caption=<span class="hljs-string" style="box-sizing: border-box; color: #dd1144;">'Data: KLL'</span>)+
  coord_flip()</span></code></pre><p style="box-sizing: border-box; margin: 0px 0px 10px;"></p><div class="separator" style="clear: both; text-align: center;"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjprAk03srWuas-BZEtXudLLyQ-aY91ofEeMJa0lwmrpik81QT8ZFl1RG-RGkGtU6-zEuopONUruLjPxcfckKEbWOr7xmoz_UTLb-4scOumxHhValtcSCp57Er08va-PAATrF97q2poVr8c6Vl5wE5q5lmnqZl2t057nQU_LB_Igmb5ORA6FyO9ybbv/s720/unnamed-chunk-72-1.png" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="504" data-original-width="720" height="448" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjprAk03srWuas-BZEtXudLLyQ-aY91ofEeMJa0lwmrpik81QT8ZFl1RG-RGkGtU6-zEuopONUruLjPxcfckKEbWOr7xmoz_UTLb-4scOumxHhValtcSCp57Er08va-PAATrF97q2poVr8c6Vl5wE5q5lmnqZl2t057nQU_LB_Igmb5ORA6FyO9ybbv/w640-h448/unnamed-chunk-72-1.png" width="640" /></a></div><p></p><div class="section level1" id="machine-learning-with-structural-features" style="box-sizing: border-box;"><div class="section level2" id="data-preparation-for-xgboost" style="box-sizing: border-box;"><p style="box-sizing: border-box; margin: 0px 0px 10px;"><span style="color: #444444; font-family: helvetica;">That does tell us something- the presence of mud/mortar/stone superstructures as a variable has very high gain compared to everything else. This means that it is the feature with the most information for predicting the binary damage variable we created. The significance of the difference between the two superstructure categories can be verified with a two-sample t-test:</span></p><pre class="r" style="background-color: whitesmoke; border-radius: 4px; border: 1px solid rgb(204, 204, 204); box-sizing: border-box; color: #333333; line-height: 1.428571; margin-bottom: 10px; margin-top: 0px; overflow-wrap: break-word; overflow: auto; padding: 9.5px; word-break: break-all;"><code class="hljs" style="border-radius: 0px; box-sizing: border-box; padding: 0px; white-space: pre-wrap;"><span style="font-size: x-small;"><span class="hljs-comment" style="box-sizing: border-box; color: #999988; font-style: italic;">#vector of classifications with each mud/mortar/stone flag</span>
mms_t &lt;- onehot$damage_grade[onehot$has_superstructure_mud_mortar_stone == <span class="hljs-number" style="box-sizing: border-box; color: #009999;">1</span>]
mms_f &lt;- onehot$damage_grade[onehot$has_superstructure_mud_mortar_stone == <span class="hljs-number" style="box-sizing: border-box; color: #009999;">0</span>]
t.test(mms_t, mms_f, paired = <span class="hljs-literal" style="box-sizing: border-box; color: #990073;">FALSE</span>)</span></code></pre><pre style="background-color: white; border-radius: 4px; border: 1px solid rgb(204, 204, 204); box-sizing: border-box; color: #333333; line-height: 1.428571; margin-bottom: 10px; margin-top: 0px; overflow-wrap: break-word; overflow: auto; padding: 9.5px; word-break: break-all;"><code class="hljs" style="border-radius: 0px; box-sizing: border-box; padding: 0px; white-space: pre-wrap;"><span style="font-size: x-small;">## 
##  Welch Two Sample t-test
## 
## data:  mms_t and mms_f
## t = 393.53, df = 253571, p-value &lt; 0.00000000000000022
## alternative hypothesis: true difference in means is not equal to 0
## 95 percent confidence interval:
##  0.4755483 0.4803089
## sample estimates:
## mean of x mean of y 
## 0.6985456 0.2206170</span></code></pre><p style="box-sizing: border-box; margin: 0px 0px 10px;"><span style="color: #444444; font-family: helvetica;">Since the mean value of outcomes with this type of superstructure was significantly closer to 1 (near total collapse), you would not want to be in this type of building when the earthquake hits! And that makes sense, with many other superstructures in the data set utilizing timber or concrete.</span></p></div></div><div class="section level1" id="references" style="box-sizing: border-box;"><h1 style="text-align: left;"><span style="color: #444444; font-family: helvetica;">References</span></h1><p style="box-sizing: border-box; margin: 0px 0px 10px;"><span class="math inline" style="box-sizing: border-box;"><span style="color: #444444; font-family: helvetica;"><span class="MathJax" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msup&gt;&lt;mi&gt;&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msup&gt;&lt;/math&gt;" id="MathJax-Element-7-Frame" role="presentation" style="border: 0px; box-sizing: border-box; direction: ltr; display: inline; float: none; font-size: 14px; line-height: normal; margin: 0px; max-height: none; max-width: none; min-height: 0px; min-width: 0px; overflow-wrap: normal; padding: 0px; position: relative; white-space: nowrap; word-spacing: normal;" tabindex="0"><nobr aria-hidden="true" style="border: 0px; box-sizing: border-box; line-height: normal; margin: 0px; max-height: 5000em; max-width: 5000em; min-height: 0px; min-width: 0px; padding: 0px; transition: none 0s ease 0s; vertical-align: 0px;"><span class="math" id="MathJax-Span-31" style="border: 0px; box-sizing: border-box; display: inline-block; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px; width: 0.598em;"><span style="border: 0px; box-sizing: border-box; display: inline-block; font-size: 16.799999px; height: 0px; line-height: normal; margin: 0px; padding: 0px; position: relative; transition: none 0s ease 0s; vertical-align: 0px; width: 0.479em;"><span style="border: 0px; box-sizing: border-box; clip: rect(1.193em, 1000.479em, 2.384em, -999.997em); left: 0em; line-height: normal; margin: 0px; padding: 0px; position: absolute; top: -2.199em; transition: none 0s ease 0s; vertical-align: 0px;"><span class="mrow" id="MathJax-Span-32" style="border: 0px; box-sizing: border-box; display: inline; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px;"><span class="msubsup" id="MathJax-Span-33" style="border: 0px; box-sizing: border-box; display: inline; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px;"><span style="border: 0px; box-sizing: border-box; display: inline-block; height: 0px; line-height: normal; margin: 0px; padding: 0px; position: relative; transition: none 0s ease 0s; vertical-align: 0px; width: 0.42em;"><span style="border: 0px; box-sizing: border-box; clip: rect(3.812em, 1000.003em, 4.17em, -999.997em); left: 0em; line-height: normal; margin: 0px; padding: 0px; position: absolute; top: -3.985em; transition: none 0s ease 0s; vertical-align: 0px;"><span class="mi" id="MathJax-Span-34" style="border: 0px; box-sizing: border-box; display: inline; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px;"></span><span style="border: 0px; box-sizing: border-box; display: inline-block; height: 3.991em; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px; width: 0px;"></span></span><span style="border: 0px; box-sizing: border-box; left: 0em; line-height: normal; margin: 0px; padding: 0px; position: absolute; top: -4.342em; transition: none 0s ease 0s; vertical-align: 0px;"><span class="mn" id="MathJax-Span-35" style="border: 0px; box-sizing: border-box; display: inline; font-size: 11.877599px; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px;">1</span><span style="border: 0px; box-sizing: border-box; display: inline-block; height: 3.991em; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px; width: 0px;"></span></span></span></span></span><span style="border: 0px; box-sizing: border-box; display: inline-block; height: 2.205em; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px; width: 0px;"></span></span></span><span style="border-left-style: solid; border-width: 0px; box-sizing: border-box; display: inline-block; height: 1.146em; line-height: normal; margin: 0px; overflow: hidden; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: -0.068em; width: 0px;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation" style="-webkit-user-select: none; border: 0px; box-sizing: border-box; clip: rect(1px, 1px, 1px, 1px); display: inline; height: 1px; left: 0px; line-height: normal; margin: 0px; overflow: hidden; padding: 0px; position: static; top: 0px; transition: none 0s ease 0s; vertical-align: 0px; width: 1px;"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi></mi><mn></mn></msup></math></span></span>&nbsp;Earthquake Data Portal. Kathmandu Living Labs.&nbsp;<a class="uri" href="https://www.kathmandulivinglabs.org/projects/earthquake-data-portal" style="box-sizing: border-box; text-decoration: none;">https://www.kathmandulivinglabs.org/projects/earthquake-data-portal</a>.</span></span></p><p style="box-sizing: border-box; margin: 0px 0px 10px;"><span class="math inline" style="box-sizing: border-box;"><span style="color: #444444; font-family: helvetica;"><span class="MathJax" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msup&gt;&lt;mi&gt;&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;/math&gt;" id="MathJax-Element-8-Frame" role="presentation" style="border: 0px; box-sizing: border-box; direction: ltr; display: inline; float: none; font-size: 14px; line-height: normal; margin: 0px; max-height: none; max-width: none; min-height: 0px; min-width: 0px; overflow-wrap: normal; padding: 0px; position: relative; white-space: nowrap; word-spacing: normal;" tabindex="0"><nobr aria-hidden="true" style="border: 0px; box-sizing: border-box; line-height: normal; margin: 0px; max-height: 5000em; max-width: 5000em; min-height: 0px; min-width: 0px; padding: 0px; transition: none 0s ease 0s; vertical-align: 0px;"><span class="math" id="MathJax-Span-36" style="border: 0px; box-sizing: border-box; display: inline-block; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px; width: 0.598em;"><span style="border: 0px; box-sizing: border-box; display: inline-block; font-size: 16.799999px; height: 0px; line-height: normal; margin: 0px; padding: 0px; position: relative; transition: none 0s ease 0s; vertical-align: 0px; width: 0.479em;"><span style="border: 0px; box-sizing: border-box; clip: rect(1.193em, 1000.479em, 2.384em, -999.997em); left: 0em; line-height: normal; margin: 0px; padding: 0px; position: absolute; top: -2.199em; transition: none 0s ease 0s; vertical-align: 0px;"><span class="mrow" id="MathJax-Span-37" style="border: 0px; box-sizing: border-box; display: inline; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px;"><span class="msubsup" id="MathJax-Span-38" style="border: 0px; box-sizing: border-box; display: inline; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px;"><span style="border: 0px; box-sizing: border-box; display: inline-block; height: 0px; line-height: normal; margin: 0px; padding: 0px; position: relative; transition: none 0s ease 0s; vertical-align: 0px; width: 0.42em;"><span style="border: 0px; box-sizing: border-box; clip: rect(3.812em, 1000.003em, 4.17em, -999.997em); left: 0em; line-height: normal; margin: 0px; padding: 0px; position: absolute; top: -3.985em; transition: none 0s ease 0s; vertical-align: 0px;"><span class="mi" id="MathJax-Span-39" style="border: 0px; box-sizing: border-box; display: inline; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px;"></span><span style="border: 0px; box-sizing: border-box; display: inline-block; height: 3.991em; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px; width: 0px;"></span></span><span style="border: 0px; box-sizing: border-box; left: 0em; line-height: normal; margin: 0px; padding: 0px; position: absolute; top: -4.342em; transition: none 0s ease 0s; vertical-align: 0px;"><span class="mn" id="MathJax-Span-40" style="border: 0px; box-sizing: border-box; display: inline; font-size: 11.877599px; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px;">2</span><span style="border: 0px; box-sizing: border-box; display: inline-block; height: 3.991em; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px; width: 0px;"></span></span></span></span></span><span style="border: 0px; box-sizing: border-box; display: inline-block; height: 2.205em; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px; width: 0px;"></span></span></span><span style="border-left-style: solid; border-width: 0px; box-sizing: border-box; display: inline-block; height: 1.146em; line-height: normal; margin: 0px; overflow: hidden; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: -0.068em; width: 0px;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation" style="-webkit-user-select: none; border: 0px; box-sizing: border-box; clip: rect(1px, 1px, 1px, 1px); display: inline; height: 1px; left: 0px; line-height: normal; margin: 0px; overflow: hidden; padding: 0px; position: static; top: 0px; transition: none 0s ease 0s; vertical-align: 0px; width: 1px;"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi></mi><mn></mn></msup></math></span></span>&nbsp;2015 Nepal earthquake: Open data portal. 2015 Nepal Earthquake: Open Data Portal.&nbsp;<a class="uri" href="https://eq2015.npc.gov.np/#/download" style="box-sizing: border-box; text-decoration: none;">https://eq2015.npc.gov.np/#/download</a>.</span></span></p><p style="box-sizing: border-box; margin: 0px 0px 10px;"><span class="math inline" style="box-sizing: border-box;"><span style="color: #444444; font-family: helvetica;"><span class="MathJax" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msup&gt;&lt;mi&gt;&lt;/mi&gt;&lt;mn&gt;3&lt;/mn&gt;&lt;/msup&gt;&lt;/math&gt;" id="MathJax-Element-9-Frame" role="presentation" style="border: 0px; box-sizing: border-box; direction: ltr; display: inline; float: none; font-size: 14px; line-height: normal; margin: 0px; max-height: none; max-width: none; min-height: 0px; min-width: 0px; overflow-wrap: normal; padding: 0px; position: relative; white-space: nowrap; word-spacing: normal;" tabindex="0"><nobr aria-hidden="true" style="border: 0px; box-sizing: border-box; line-height: normal; margin: 0px; max-height: 5000em; max-width: 5000em; min-height: 0px; min-width: 0px; padding: 0px; transition: none 0s ease 0s; vertical-align: 0px;"><span class="math" id="MathJax-Span-41" style="border: 0px; box-sizing: border-box; display: inline-block; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px; width: 0.598em;"><span style="border: 0px; box-sizing: border-box; display: inline-block; font-size: 16.799999px; height: 0px; line-height: normal; margin: 0px; padding: 0px; position: relative; transition: none 0s ease 0s; vertical-align: 0px; width: 0.479em;"><span style="border: 0px; box-sizing: border-box; clip: rect(1.193em, 1000.479em, 2.384em, -999.997em); left: 0em; line-height: normal; margin: 0px; padding: 0px; position: absolute; top: -2.199em; transition: none 0s ease 0s; vertical-align: 0px;"><span class="mrow" id="MathJax-Span-42" style="border: 0px; box-sizing: border-box; display: inline; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px;"><span class="msubsup" id="MathJax-Span-43" style="border: 0px; box-sizing: border-box; display: inline; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px;"><span style="border: 0px; box-sizing: border-box; display: inline-block; height: 0px; line-height: normal; margin: 0px; padding: 0px; position: relative; transition: none 0s ease 0s; vertical-align: 0px; width: 0.42em;"><span style="border: 0px; box-sizing: border-box; clip: rect(3.812em, 1000.003em, 4.17em, -999.997em); left: 0em; line-height: normal; margin: 0px; padding: 0px; position: absolute; top: -3.985em; transition: none 0s ease 0s; vertical-align: 0px;"><span class="mi" id="MathJax-Span-44" style="border: 0px; box-sizing: border-box; display: inline; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px;"></span><span style="border: 0px; box-sizing: border-box; display: inline-block; height: 3.991em; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px; width: 0px;"></span></span><span style="border: 0px; box-sizing: border-box; left: 0em; line-height: normal; margin: 0px; padding: 0px; position: absolute; top: -4.342em; transition: none 0s ease 0s; vertical-align: 0px;"><span class="mn" id="MathJax-Span-45" style="border: 0px; box-sizing: border-box; display: inline; font-size: 11.877599px; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px;">3</span><span style="border: 0px; box-sizing: border-box; display: inline-block; height: 3.991em; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px; width: 0px;"></span></span></span></span></span><span style="border: 0px; box-sizing: border-box; display: inline-block; height: 2.205em; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px; width: 0px;"></span></span></span><span style="border-left-style: solid; border-width: 0px; box-sizing: border-box; display: inline-block; height: 1.146em; line-height: normal; margin: 0px; overflow: hidden; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: -0.068em; width: 0px;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation" style="-webkit-user-select: none; border: 0px; box-sizing: border-box; clip: rect(1px, 1px, 1px, 1px); display: inline; height: 1px; left: 0px; line-height: normal; margin: 0px; overflow: hidden; padding: 0px; position: static; top: 0px; transition: none 0s ease 0s; vertical-align: 0px; width: 1px;"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi></mi><mn></mn></msup></math></span></span>&nbsp;Documentation. 2015 Nepal Earthquake: Open Data Portal.&nbsp;<a class="uri" href="http://eq2015.npc.gov.np/docs/#/faqs/faqs" style="box-sizing: border-box; text-decoration: none;">http://eq2015.npc.gov.np/docs/#/faqs/faqs</a>.</span></span></p><p style="box-sizing: border-box; margin: 0px 0px 10px;"><span class="math inline" style="box-sizing: border-box;"><span style="color: #444444; font-family: helvetica;"><span class="MathJax" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msup&gt;&lt;mi&gt;&lt;/mi&gt;&lt;mn&gt;4&lt;/mn&gt;&lt;/msup&gt;&lt;/math&gt;" id="MathJax-Element-10-Frame" role="presentation" style="border: 0px; box-sizing: border-box; direction: ltr; display: inline; float: none; font-size: 14px; line-height: normal; margin: 0px; max-height: none; max-width: none; min-height: 0px; min-width: 0px; overflow-wrap: normal; padding: 0px; position: relative; white-space: nowrap; word-spacing: normal;" tabindex="0"><nobr aria-hidden="true" style="border: 0px; box-sizing: border-box; line-height: normal; margin: 0px; max-height: 5000em; max-width: 5000em; min-height: 0px; min-width: 0px; padding: 0px; transition: none 0s ease 0s; vertical-align: 0px;"><span class="math" id="MathJax-Span-46" style="border: 0px; box-sizing: border-box; display: inline-block; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px; width: 0.598em;"><span style="border: 0px; box-sizing: border-box; display: inline-block; font-size: 16.799999px; height: 0px; line-height: normal; margin: 0px; padding: 0px; position: relative; transition: none 0s ease 0s; vertical-align: 0px; width: 0.479em;"><span style="border: 0px; box-sizing: border-box; clip: rect(1.193em, 1000.479em, 2.384em, -999.997em); left: 0em; line-height: normal; margin: 0px; padding: 0px; position: absolute; top: -2.199em; transition: none 0s ease 0s; vertical-align: 0px;"><span class="mrow" id="MathJax-Span-47" style="border: 0px; box-sizing: border-box; display: inline; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px;"><span class="msubsup" id="MathJax-Span-48" style="border: 0px; box-sizing: border-box; display: inline; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px;"><span style="border: 0px; box-sizing: border-box; display: inline-block; height: 0px; line-height: normal; margin: 0px; padding: 0px; position: relative; transition: none 0s ease 0s; vertical-align: 0px; width: 0.42em;"><span style="border: 0px; box-sizing: border-box; clip: rect(3.812em, 1000.003em, 4.17em, -999.997em); left: 0em; line-height: normal; margin: 0px; padding: 0px; position: absolute; top: -3.985em; transition: none 0s ease 0s; vertical-align: 0px;"><span class="mi" id="MathJax-Span-49" style="border: 0px; box-sizing: border-box; display: inline; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px;"></span><span style="border: 0px; box-sizing: border-box; display: inline-block; height: 3.991em; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px; width: 0px;"></span></span><span style="border: 0px; box-sizing: border-box; left: 0em; line-height: normal; margin: 0px; padding: 0px; position: absolute; top: -4.342em; transition: none 0s ease 0s; vertical-align: 0px;"><span class="mn" id="MathJax-Span-50" style="border: 0px; box-sizing: border-box; display: inline; font-size: 11.877599px; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px;">4</span><span style="border: 0px; box-sizing: border-box; display: inline-block; height: 3.991em; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px; width: 0px;"></span></span></span></span></span><span style="border: 0px; box-sizing: border-box; display: inline-block; height: 2.205em; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px; width: 0px;"></span></span></span><span style="border-left-style: solid; border-width: 0px; box-sizing: border-box; display: inline-block; height: 1.146em; line-height: normal; margin: 0px; overflow: hidden; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: -0.068em; width: 0px;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation" style="-webkit-user-select: none; border: 0px; box-sizing: border-box; clip: rect(1px, 1px, 1px, 1px); display: inline; height: 1px; left: 0px; line-height: normal; margin: 0px; overflow: hidden; padding: 0px; position: static; top: 0px; transition: none 0s ease 0s; vertical-align: 0px; width: 1px;"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi></mi><mn></mn></msup></math></span></span>&nbsp;Country: Nepal. GADM.&nbsp;<a class="uri" href="https://gadm.org/download_country.html" style="box-sizing: border-box; text-decoration: none;">https://gadm.org/download_country.html</a>.</span></span></p><p style="box-sizing: border-box; margin: 0px 0px 10px;"><span class="math inline" style="box-sizing: border-box;"><span style="color: #444444; font-family: helvetica;"><span class="MathJax" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msup&gt;&lt;mi&gt;&lt;/mi&gt;&lt;mn&gt;5&lt;/mn&gt;&lt;/msup&gt;&lt;/math&gt;" id="MathJax-Element-11-Frame" role="presentation" style="border: 0px; box-sizing: border-box; direction: ltr; display: inline; float: none; font-size: 14px; line-height: normal; margin: 0px; max-height: none; max-width: none; min-height: 0px; min-width: 0px; overflow-wrap: normal; padding: 0px; position: relative; white-space: nowrap; word-spacing: normal;" tabindex="0"><nobr aria-hidden="true" style="border: 0px; box-sizing: border-box; line-height: normal; margin: 0px; max-height: 5000em; max-width: 5000em; min-height: 0px; min-width: 0px; padding: 0px; transition: none 0s ease 0s; vertical-align: 0px;"><span class="math" id="MathJax-Span-51" style="border: 0px; box-sizing: border-box; display: inline-block; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px; width: 0.598em;"><span style="border: 0px; box-sizing: border-box; display: inline-block; font-size: 16.799999px; height: 0px; line-height: normal; margin: 0px; padding: 0px; position: relative; transition: none 0s ease 0s; vertical-align: 0px; width: 0.479em;"><span style="border: 0px; box-sizing: border-box; clip: rect(1.193em, 1000.479em, 2.384em, -999.997em); left: 0em; line-height: normal; margin: 0px; padding: 0px; position: absolute; top: -2.199em; transition: none 0s ease 0s; vertical-align: 0px;"><span class="mrow" id="MathJax-Span-52" style="border: 0px; box-sizing: border-box; display: inline; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px;"><span class="msubsup" id="MathJax-Span-53" style="border: 0px; box-sizing: border-box; display: inline; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px;"><span style="border: 0px; box-sizing: border-box; display: inline-block; height: 0px; line-height: normal; margin: 0px; padding: 0px; position: relative; transition: none 0s ease 0s; vertical-align: 0px; width: 0.42em;"><span style="border: 0px; box-sizing: border-box; clip: rect(3.812em, 1000.003em, 4.17em, -999.997em); left: 0em; line-height: normal; margin: 0px; padding: 0px; position: absolute; top: -3.985em; transition: none 0s ease 0s; vertical-align: 0px;"><span class="mi" id="MathJax-Span-54" style="border: 0px; box-sizing: border-box; display: inline; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px;"></span><span style="border: 0px; box-sizing: border-box; display: inline-block; height: 3.991em; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px; width: 0px;"></span></span><span style="border: 0px; box-sizing: border-box; left: 0em; line-height: normal; margin: 0px; padding: 0px; position: absolute; top: -4.342em; transition: none 0s ease 0s; vertical-align: 0px;"><span class="mn" id="MathJax-Span-55" style="border: 0px; box-sizing: border-box; display: inline; font-size: 11.877599px; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px;">5</span><span style="border: 0px; box-sizing: border-box; display: inline-block; height: 3.991em; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px; width: 0px;"></span></span></span></span></span><span style="border: 0px; box-sizing: border-box; display: inline-block; height: 2.205em; line-height: normal; margin: 0px; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: 0px; width: 0px;"></span></span></span><span style="border-left-style: solid; border-width: 0px; box-sizing: border-box; display: inline-block; height: 1.146em; line-height: normal; margin: 0px; overflow: hidden; padding: 0px; position: static; transition: none 0s ease 0s; vertical-align: -0.068em; width: 0px;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation" style="-webkit-user-select: none; border: 0px; box-sizing: border-box; clip: rect(1px, 1px, 1px, 1px); display: inline; height: 1px; left: 0px; line-height: normal; margin: 0px; overflow: hidden; padding: 0px; position: static; top: 0px; transition: none 0s ease 0s; vertical-align: 0px; width: 1px;"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi></mi><mn></mn></msup></math></span></span>&nbsp;XGBoost 1.6.2 documentation. dmlc XGBoost.&nbsp;<a class="uri" href="https://xgboost.readthedocs.io/en/stable/" style="box-sizing: border-box; text-decoration: none;">https://xgboost.readthedocs.io/en/stable/</a>.</span></span></p></div></div>